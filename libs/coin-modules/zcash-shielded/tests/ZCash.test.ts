import ZCash from "../src/ZCash";
import {
  testAccount1,
  blockWithMyTx,
  txShieldedOrchard,
  blockWithoutMyTx,
  blockWithoutAnyTx,
  txShieldedNotMine,
  testAccount2,
  decryptedSaplingData,
  decryptedOrchardData,
} from "./testAccounts";
import { server } from "../mocks/node";

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

describe("estimatedSyncTime", () => {
  beforeEach(() => {
    jest.useFakeTimers();
  });

  afterEach(() => {
    jest.useRealTimers();
  });

  test("estimates the sync time", async () => {
    jest.setSystemTime(new Date("2016-10-28T00:00:00.000Z"));
    const zcash = new ZCash();
    const estimatedSyncTime = await zcash.estimatedSyncTime(10);
    jest.setSystemTime(new Date("2016-10-28T00:20:00.000Z"));
    const estimatedSyncTimeResult = estimatedSyncTime();
    expect(estimatedSyncTimeResult).toEqual({ hours: 3, minutes: 20 });
  });
});

describe("findBlockHeight", () => {
  test("finds the lowest block height", async () => {
    const zcash = new ZCash();
    const height = await zcash.findBlockHeight(1234);
    expect(height).toEqual(1276);
  });
});

describe("decryptTransaction", () => {
  test("fails to decrypt memo: UFVK decode failed", async () => {
    const zcash = new ZCash();
    zcash
      .decryptTransaction("transaction", "viewingkey")
      .catch(error =>
        expect(error.message).toMatch("Failed to decrypt memo: UFVK decode failed: NotUnified"),
      );
  });

  test("fails to decrypt memo: hex decode failed", async () => {
    const zcash = new ZCash();
    zcash
      .decryptTransaction("transaction", testAccount1.viewingKey)
      .catch(error =>
        expect(error.message).toMatch("Failed to decrypt memo: Hex decode failed: OddLength"),
      );
  });

  test("decrypts an orchard transaction", async () => {
    const zcash = new ZCash();
    const height = await zcash.decryptTransaction(txShieldedOrchard.hex, testAccount1.viewingKey);
    expect(height).toEqual({
      orchard_outputs: [
        {
          amount: 0.3,
          memo: "Thanks for using testnet.ZecFaucet.com",
          transfer_type: "incoming",
        },
      ],
      sapling_outputs: [],
    });
  });

  test("decrypts a sapling transaction", async () => {
    const zcash = new ZCash();
    const height = await zcash.decryptTransaction(
      "050000800a27a726f04dec4d00000000a6293a00000000021690546cd26e6db813142ebe6f85cf1d526693f31ae575b473ab8732558911d8115568656e8a9e7a608bc7baf845114e1cb46d25fdb675ba022ff426cac5e35da02d26d53dff40661552ca76cc444af4b5ca121fc364c8126e4cd8039e3021975a300d5e9fc9661698bd149ec49a077ce9643d0deb792e471799d94d4530a8bb01bcb988dc2ddd8fb5030e44b4b6533c965b7c82516e3539da5578e27ff2fc30c47ce646584653f0fdf8743bbc812c1fc32aa6c2a2a04111c63067f51d3032befa669de4546986f70addf13f4faf31dc52a03aeffd45d8519dee687f68ae904e59fdc1c20d76f2267b82506d08810eda92993284fc5063a40818b83fdfcaa8c24a8f735698a384eaaa49bcf84d2868ebd47247916b00c77641b01019a3181d5c287bbd6c96756337bcd15a0717d7ce84346bfd30e32d5269bc79b664ff6de072e2259c283b13558fc568f065b4bdaeb69fbf4a85898b603263d6eb95914d72b224c72dd7bb0ac22282ac9b60b647351c973319a4ceb0ce9389a83ca7efc06e31a6ab0c76de6be4aa0eb786be646bc094ed2ac7f6901e07035c60d491163589713b69ffac244d2b50f2e8dbe14c8b6f77a1b1453aafa2b6182229084dc6227824ea19afe71677aa4243cc5fd3b1de6b190552f7db39a20eee4ccfcf02e6aa50d129cef00af8559332a61847ada5f6d0568348283aeb76fc5e5844ef56b0c2b8392b3e9f46b9db0fb1e819fb6b31c2776060056dd56d268e96b02eb819459ff6791ec3a6b6a85ae7aae1bb252d3c32c83b22adf2e5b64325654c5e1b67f78da4cb4a8f52e7735851806c15639a22329d6bc8fd9cd1b8545ceb397456299050daf65729a81a66a2ac4a353d690cd43d79b0d032e3f801590e3504aba3d9c6a751fed42970ab3217f0b165f3bfdfa7d4aa910bee648457b0e100e0397d2e4890cc16a54ad9801feba09949788b797967cdc725dea8bf1f3b6feb1d756b7f8c25af9e78037460ee1158b016b0b83c1786c51f2e466488e96db93850f4c77b2df448f74ddc2cefe4ae9eb50e46e9d6eadadce9eccff1ca6bacb197b6cbcffceab1bdb51eaa8976f28f5870feba9e632566981b0eae2cc305d8c5f20063ee98c2cb99ac5caf0b69342c59af863f8ca4a956dcfd5acce26cf268deed0ee477380958929347fede2355aa50425afd24f2f224869cd09cb01731b0828e8c8cee0dfb039bbcf2ef0d9fdbbbf2c28afd6757ce2a8ff2986a4a40a6bfae7140146d75e1cc34d12af10bbdcad93b7fc71cb4d01c5391f1f08e0d44a99f23d93363fbcaf44f79fd3ac29696c8b7464ddee5d18e839d5cc39ffb53f00dfb9fb5e366066bc0dc0ace0d866b6596aa21108633c31ab7409365dcb13b32a446d5e159aa6f6e78645e63763935221ead9a53abdba851f18545c73a9b62c39931747910488eb9d98007b4316322addf4a78b1cadf1d34c53ac9e95f5cff1cd5c32ba39884703ed6330a0f38487a0a4fe1bde01220e29a4d3fe17702810e8dd065c72f44c605d3fed4d01c983e7750c5183c1610d98d1db700d4d054540288a2233c2385086f9856e57f16f9251a52c60dc45c8a8897ca243c2d796a411828b7efa98067e41a59b78e2a1939ef03bf820048f60345845055d35b379be86091342ff909bb7cef5eb975ebac7dc3f6cc88696871710ec870fad29278e0ecc28e1dc5cde442815f048b48cfa471d88bc8b6b12f2d5d45ccff193b8e6c52fe23e2af918bc16cdadbdfe6a95d583a3e45433c3e04bfc2129abc5786753f7d9a4113b379e2d0222d7faeb4cc2242316d31c91514622834833407c40637f47b1ceadbac4f8252d7cb179c4ff25f80c6a4a7647539e22def9eb0c25f4fb806e099d1efa4f181d9afc367c6d438a6e5fc0ab3ec6d067233d4e4fe1e4310dcfa7242627be3e173e6386ff67b13fe80c1970bb8a41563e0fd081b401ea6b858ea579d47deee075ccab4a54248be2cf645f4e50cd4095dce2268e3c8a4ddb929db526fff7960d9a8a1d009adaa7d68111a269a75b59eba9f1cfacfc7f187324831a39aacebb83c53dde42cb5cf00ade06db91dc2b2df29386cc1e4ce77ac33fdce9ea6a2107f077087293962790853bfe7060185c535753503c0bdf0ffffffffffb3da3e64a0879845e7d039992a034713d159c95d3d89d815ab50f3390ddcedef7271a5e6a611618ada58f0c028c44a41a3ace5e8229a13c2d4f7af1d72202d73d1bdb4d0c05cff5a5be83b922571d1d10354e09a7b03483f963fef4f6e940e711177933c948009ef62b53622530717baba8a4490ad01121df87eb1adee592978d645b418bb85eda2c934685fa000b69db25fec9c3d2eb0f65d878237814d726215d8bdccad1d7f697a8005db30000a43ddd2dc483c1c66a419dc9e154b8430689187e6ebc1a93dfcd4422b1df40a41ba5b86c957ecd9966d6915aa1df00e2debd2fc4fea12880ae30ad4450cb8cc23529406f5de55f3be3eae838a1c5b7d39d1b8490d8c51868f73e793da8706027c699e53c9a4d5b48fb1b4a42d3e170e90d00a8908f9af7037f1cc28abee6ce965c284516c8111857f4eb6a5f39512b7736ff9265baabc9c03720172c73553e515dfb85bb26179e648da1606aa1663c82fcc4eaadd5fac192d7a41641e3751097ab42434f7cb4bc974c290a14b1e48df5bc566e4f1940964972c3227fa5e103962a220442a813c5f30f063337de014838cea34d2ca3a34d8558321ffcb9f910ff03dec73ce9192340ac4d7244f731fa54a0e02277732c68c1284fc18184ff8e19314fa9a76d81fee29cd5bac23257c7a47383a1f4f484c4f08999caae074fe19d769e8129dfd84b2d30030f7dfa1f8e8700d38b25f70393160e3e6447da0877c253cbe74c9e36176469fe9d701054d30242b38f6193e0a8079d171c5b870651b258aec6b2afc8bc35add4d8e75f94b9caa292c818971bf188dd7e98a1008c922b7327aa8e59b239cecb02c77ffc569e3591081e26a5ed0f2068b14e437b71f2075d4a51f92f5a60e96af5d965636aaaea5829e25b65bc2592445243d0f160792971ff27b7f517d4892153b8e95c345e5edb7543d2f8cfa50752db0dd114e82f50182ad2a10789aeaca20eb383b17b12ab431bde527de167bb1fb097b2f84a57fdf10c0423c80513059c85330d6159e78a46a8451ac731e2f26fd2e217d00e5c13e9f062386b192318942ee1f9181c4f4e75d3ef70c638e2c98a1088ce58e4d8fc22cf070322921d2ac06fdf24250c2ae28be258434b6673a33cf1d87cf65f4a4085d101a4ef2db7824d1e07982a562075a2081dc3cc2b70e66c444d581407722ac96301ed0993165a574e13655a9383c0549e0ad2b202194916f11152a02f65d487e1b6662b9ed9637c83f07f46004c8f9d853d444532c4dac5ccb193ab98a4fcdb0cda57f2ec79019a4d09a3a31088451c6de1026a0f94e1095e3b7db408a39bd67f345099a1c63d020f2aa81d5b05e02b436c2e24d74aa8f84b9f3b29f204c45314b1f65f57135c9ceb82991578c9ff9a076ae55af6e051b55b823720aa71ca08a7b13444335eb1dcc51c391c99bc5347412327550e998836e6534eb4314a7da55678d949a04c7dd2489385192a2d1976ae935193faa402e852eab40c775672704b66c389b6b911be95102e0c4d8ce988afe85663bac10aaca79a2bc52babf52f86f1de6ec6afa3b0cef14eb8031837e32ede476573480d9b1427eda50b8b4994f280acf40f36ef348894bded313a83d6dbb624f263deb35cebd8a7c2ccc07a4be5b5398eee2cd2eff80af3d59534503519a34bf2aec4f453be65fe3459ff50d8d025c378d55e08894e6f4672132a5061c748e9e61edf1254c4c51f9a37f37a613dba65d1302fd8ae8faefd8f21605b93903c29919f1d91e3518e51cff3dd40f685d941a3666a34d416014798ff98854c2fe7d0348f031bd079d3704a7bd098fa2b6bb1fbc0d6dc0bee6349afd2bb16c69d2889a8fd1984ac2765ac85990ce3b9c2743bf4c3a20cbff29b288409e287983e1dad257f33aa11093af0d0d52d8ee69659407c38780b2a70613fc94dd762b160e152b592c570470e9da118a9aa78ec8e18ab7263b332b42c1d63c525b48eeaf7c9eb330be21ba9938560af50e1a0d01d3f08df33092e3fce211277b6222e1b73d4f3178a6fb5a93e30fe30cba781a27f5eb71aa9328018432dbeb16fdaa61567bd3c2419e7f63852253077ab3fa30a8f474c503842997b4e84b26eba532b6afa16c665b170df166822a847d6b835bc518e268c7d7bf1e7c41e887df6dfae2d6382ca4c432c6faafb090ff79e517d53a2fb357d201978c8ddb745b483c4202f4d3b45a041c37484218fde27ae170ad2b1663a9007abade4f66d52fb873cd8e42756f2ace3b55ebc15912d462f85f56846cdf0ff1b729cf24eec702a69da93d1776fbd106d8fa32e6e627618840a629084faffc8fb241c17924f54ac682595f874f963c183ce5177cffa5280c17c942a63e8e1aa6f5058f082f9e268ac96c71d6b6eeb782bc1a4634468d5ce8eb8075ee71c1ca8a6dbdc903e47fc2aa3bf59dd9f1800cafefaf1a615a88014f61b2800c44119c1949515206b87b124e15fec2cd4244c2d4f14a9098dcda5c34bb328187d85cba59d0df8309a1b8c626da0329f55007efd560c08cd79720d3e59a5874d438c723cfc8f424ec05a2f4015f92ca26211ae44a581b45c766b0495400179ac357a1e44aa471cd06ee964833556d21e0d609a03b172a7bdea5d0683e982bcc60b683b62c44baf7997197964c2da2d1ee938dafe805770c8feb161e11ed97edb2960d2f191ddf7e88a7d492aebe677f62ee92eb10f1e0fb687d32fb6dd5aef5b6d138040ce2f0fe11ce23b31ca0da0950703ed2f020810cae9fba8dc02c00bb8ae936f4d82030bb7c9ab23da5c04b32d99697f53e7265c43e325b3cdf480c0915761056640afd3e7d9ab47c75664e8addfc590a7afe243f02c0b583d658259d6d5963198c30c5768e4f345c1bcc2c453d1dd0b1a6e964a7f53234d3d7e651dc32a5add95c04e81d7d249821962828545f15c614c14d92ddaa930360900f00000000002281e07dfc77d1d5c77803d3f4e3234113d3d7ec0625d942ddb5e0106d3b9a25fd601ca1119b9f0eee0a67ece53b362afbd3aba8cf944a0460fd33b9d32085220f1a2dfb6e4d0b03a8695c63e4b4f4608d54047edcddc1ac66cd0196b04acf4494833d664645ffd1cfd8dd401bf33ae769c66df17362989bee3f09b618f560fe83b935736ab3a1249145b2fe355ba67a137cd38f3214aba982a75de97746889d1ba4244b64589f03ae864c082657ce92cba4696a1210135b379c96f6fd2e60cac678ba2aa059a9044c29cd7623c04aa85b765919770f096ff7813976ac0556d099a18ddd95ccb15a86ff41965813d5701fbd507a4f598ecb6e6afadc9e5d6ed09e5e8d5551b9ba296145e50aa044dac915c694f9f75f310bcbbca96327a8f0db25e1b0001b0a0e13a7c71ccdd6d6ea443afcdfd5e7c75869b799e3cc781e6c106a87389f48baa90287d74c4dcfcc722c63d713bd466f80d30239fe5a7ded62aff07e1698c65abc3ee29c0b6c401317d50f685922cb16992d0c073f9b901a5000509b10f99d95ac21a57e099fc3a726d2916a0e4ec9b0948cb34b4b46607aa06e797387c82cfa37a2215dc354c517b87e7d7a83397c5ed7e203d9524556ca1813a9d719adf17c79a541b51be4403372e3072b496cb2c3c44a1b2e744ea7d60016672c8a858d23aa6212500f6812dc2b347bfac2335e6b91c05280023781aa12c80494871ab856a0da222f18fe9c64bec940ddeb0b9a81cc90079121714666c96a32181d3f5d87b3eda92edf810c6c98069d9fb54d1302cb9dfea191309f290b49e2c1284e47dfc53e0e33b16d84856bb78c428b4a751c4ae7dc670e141ae3761b0a56a3f8b16a7109a0694a3a71ef6bb9eb0895a81f0176d1c8f9526a40bef9f087838ffeda9774bf54cc3dd91eb5a4b0fafc13553d1deed89fec5661bbb5db6d61ee89f510c3090eb6a244de66381d60806d275c53c04ea9d5a783c287bc6d94415608fcd7fde2b0761aa383034f7364a7363f58e2b8a14c6da8eb037dc4c13bbcc112e66a2c56aa0d8bb5001f6aef0c6df5d91319e4de2b0cf009c7c8e8ae04b0502f9bb591336deb92df0fc34c59051562cfaa4588a7f2cb83656cf2964f2661b1947a48805f82d9d55a1fc88127ebca73fe304d91aa5d9366f466057534cac10402451d5d24b770dcdb1fc5bc03c6cb7d81b29bda41be4cbea154521ab8ee68ddb0f264c53de07763b5bb96f3cc7cb149715ce176f9f547ec9d6f0da76eedf818b7372740b24908af271dae5d27375484603e8ca5fe626ad83b31643d69aae43184019f41bc324d3d8618e2ffd2d4a7e5ec4e05f6ded7144f065151b619221ec5994c78d0777c62becc5001611614e4317c1adc2afdec0112595a2edc85ad221b1b8296dafbfdd1e7972d00e68e0fde50631c8b092fc347a1d0c4cba039ee20a29ce21584628d3a2946dc543b3b8d366115639e9cfc8ee61658b44effb8475779bd41f95b3d9514f68d8f432b6a43fcdd18e792ad2c21dd6a120fdcff97540cfbab98c7eea658ccf19f322ca22526715574e62c0efa92f4e888a9962b6f8e9f43b381cbcfa228124a2491aa8336b50b28c23e6e07515f719681d667eca0a45d65012705a1573cdf1adf5630f4b13cff62f97bd7fcfb8c41fd923736773679799707895e9c3ab494ec76c315a5abec5a5712c9d48d167d379f4095202bc0cdccfe04d83e12de29b7a9bfd41c9059e0a1003f95461a748d3b5f06529568429875e2b3f6c11d9c768ca4347d946ce3220269f5840bc1c15e39df9b57276d2762eb19233da4a7b6b4de52b09c9f11a2147b652a66b4e31fcf9bc6fd85ed78340857302d880391224c7ea17e6382cc3615fd61c1198be5296dcef5285b6d4990051df918ef86569ced92d1259e6e6342d7de5e6bcaa0b4500c9a6952245f0de11f697289e41eafffa68392dba489e0ce76389c66b347ae3ba340a52dbe74f62da5bd41bd7d5fdbe1f855483b31620afcbbecf85e1dfed50b94929b93b602a0ee86dfc021ae942a9284eecd41c8b28e09c3aed89ec363b50f4d2b420bf58b31181a766717dea8f814e74ad5f90d60fe4ca16985e67eee39b1e6ff2e9caee0ed9d4f33f8ac329f04806e547746ca8c61d5ea9f237b58d5d5240c07085bf710bb8d4ca6a61bf98a559155c3b1be81fb3853e292c53349b3e35b96f7d83f5f6781848d489d9cb5f4eb9874b342c4c625380c40e7771cb29b40ce9fff96b04e0f17822213253c9656bb4c7a7881284e56274c8b5c0de488cae76dbe6b4b06a2446d049aacf32d2fbf899bc2827e7080e899aca560f435db97724d0b428b0f9225df922f04f40c2b29d1a44310d72d26a558de437a652a3939afa4b79b388d0db5f9e5fa8849b98f628330b65068544731fce921a8dbb4e72200f31c75a9080fa9586dfce33f08d199bf6975dae325075fb663fc5ec8a9b4618dd9bac20fd1254a74e04bb1991376873644c9133d5a5ceadb8ce13f8a985f6951dc9b32c22fd44cf28e1d261e07fd32932b2d1067a6c2809d6922e5137d9dc79411c143d8b007ce4186b55aa62d43eb4c87441f4e6bbba9f7f7685e32f2dceddb767e5df80b3813a03eaaa5a41b89422dadbd868b6a6d45328d7d435e864864ce3177e4d1f1929913af3d5ae7305955ca1a0c2c83dd72a6b24da9f58335a99acf517b55d8ac60b5270abb8a7d0d248eb7fe444e0242ac2a16715483e827e529c3ee7badad9520bc762a16b85012863ee38f65434b75a97e8b5eed0962046947083606a7b4bbc2286e69a691aa38d2646c1075492a1ad105081b6518ef00560aca52c217b05fefbef8e461368310449f53017ea70a24ec5fbd88343b007dbd4df330eec040f65708fded16556811d6135ff5ffae94bc967fc98e8596411defe2bf5f67428f9494b0baa6149e5f13b31bbda2685877d2b4e903d36a10467edcd0e462bc6ca4255707d8f2a6fd881495138244d4de61577dfe9717f66c42d4001c00f1833bad8650c6394a42f7992b21abddfde21342218309f5152d7257fda8d8d9d2837e886b2ecd4baa62c7fc029420ad33bca144caffab917c545037e04dc8a28f32ba5994cb0f21bd6fd31300ca07248c0c152200afe43b7b6ef66086244793ac760add2869772840a90e91022e5431ee288b08c889f4b76a59aff8eea78bbbf2c600b674dda766439a01783837c9e9bba9ab9a0ac8a5aa226d7fc1d7f24116f81493a391b1f62332c20fe537c09f382a92e9a69ea77a5a1e7b83658797159a0bb0e546cedc8184cc1b79e002a929431ba4df75df16b7e55c62f996becc55cf544df4fb9f55b6aad67e70e93fbb23b73862ae41e680bc906c925dc6bebf9295b39d7e05d43e8bc797166782227cfb3243e6c1614197777b0d4b3333c986702d90f520989f4b9da0dd867cfa2dd559dbd0f602e183e247bb741d648f5aebeaaa23ce9c982af840e7ba4fa3053264165e615c7bbfed6a8aecbe9413890cb153d68819b553d5f9548a6b2b2b4e2d1239afc20bb7991114e55634e900a851c361133ad77bcc04a885d885147d331b54468cc0511fc0e1670f28fecbe5534043400483af7ce7a202076aa024ea762974c71f82ce9ff302abe57ce2d96f4d06f5540bae482ad83081aab35c78feaa3287f8b11df94bd4cabe80f938aef6ef44c5217d25015253240b216962ec5473101379d92c486deaf78e221b8af7cc27dfb2ac897aeceaf9a7434cc551ccc9b83c88dbbcaebbb4dc4c62af0626488c4dfb5612d35ef63d22f5266d2d919b767417e8712d450191c9b7bbfe9b157eef39e48a3671a703ab667f9074803cc2334012bd55997b11423a8b941c53113e645f98fecce3992015740650b4d212999ce6146d13cbdeca3d5e7c548c7e4f623a29e01af5cda44eb6edfa8706db63fff70c359e14bfd83412641d8b0abb829fa8ff9653a93e059170ad1b2eac9130c1498137f5be79ab12b331ead9e1f21972f1ce90e879108a17c4c08101f643d2bc33e71e85e37b4f1560144e3677bbaa1dd4ee49d351cf67a2bbe84703fcaae0da080f037a7af5946c1a891aebbfd690b502bd79cfd2829a31daa6660bcd936550d56d01fa2a46df83f7d3fdfd98d50d65c0c712ff274470d52cb4da1070cc4fa8bd8f3a110a87ba790727af6d09acad0c838cef1ccadf452e914feabb94474ec6c76d1085a276534ba835a490d923df662332debe0721e4fbc9ce1c3083d344c6268d1278b97c80c2dfb168ce332b86fc9a8141458cd0d704376dd8b1419c409291c229e5f8fc88f1668e7106b9cae31412610cc30e92a69a0ffd2743bdbf1746c22f18af6e7b4375d92b1ac20da26751f431f5803aff6a88a42f0e92cff9f254b0ee2bd16836010a0a12b4a14f99575fd589251fd6c1e2de3b6ee07483400c1ccd7337728301569069b1065a72bdef3bfb09835b9fd95e1caf1304c7162b4eabf27f196d246bf47f0ae46c07a51057bf5340483a5322244d6f03daba481250d7d6872de8d0934f98e5f77323ee571f9e0a75571be1c1a80cf037c42e7b848c8814913f65fc517c2b6e960f3e5a156f08bad12524966fd5e74b9d68128d85e0844009367733187962df33db1d196f2f64e823a585be79b81ded3afd4699c12c7a939e1e249e2747e624163c428001840c656b82389bae0a75f940d44c9aa03c54a576224cc659a4abac6a1a6b6e8ebd77ea02992043c28a80cd789826caf152a1f66818583c45dd32dbeb7066df37794c0c839500279916bdde7fae413d27df5141d529d3aaf2f3428929b8622a0a0bd46a6aed13883b30c453785f60d18f1bcdd10822d62083ab726a9fff5fdb2d83a2c89130ac91644985ae524d00509eac52c37818be1ac4c2bf9435de08a430957974cacdee6742ab172d2fa4b65871038301372dc58bfc9c9fd3db4aed3635d631518b20397695968047ed8672012760b122483cf9693207dbbaed34bb1e3bd498eb014b5055079fcc12b5f7e9eb46557f776623bbca8fc954b7eeb578af72b252b56fe307bb3de3720f7ba9b4f91d72ecc9fd27bf5d270f7945d12643d46a842b57d85498bf1717c58bbbdf65f84e50dd456e222eb2d6d7d4ee170e8f52e54157e87c28c8b317704183aea1b1fcf697b520a4283d9472d6cc4c3411853da19b048c15332e6f1b5f1e99684e927796d4418d3a3402f4fe1d1504f225881a59447b55c0a8197d28517895fe2c591e641a1576430ec4db6d928c6805138d8f6d7721e95402eb786dc491b4ef4542ed4f6074bb3c25fd092e1b74e6e295781b2a709a4a640cdfe965489e566f2f67f5f51aa45ca90a9b6c4f13faeda596ad5bfff69adf285296c13d8e43c421b4631eeb45c834980e2158f181cc572145b78889f1e85e0ea78434bb7b11bf7c8183c03ca8d5b3c71a641d5299a3f96292a11c29ac1bcc197cea126c5498eef000af2ddc6f82d2c41d284efcc30d43094a2689df863159b79e45b4918ec4678fb584da7985c9e4fa1b25d1b19cc926d5400f0d8aad919bfa755fbec2697474e8dc773b72d1f0177916b88830e758451bd0ee16c89ab8b42635cc54965148799f8424f0916b710a98001a61653255468ce5e43a5d471b3bf5f20f6f14a51d706810cc73c8bc1d3db33b6d4ad9e0d94387d129644635a2236a7475cde95baa78cd77b7d9b6281c53391ab1f1f03d459ffe12b427000eed1fc11533b3f7db80f19d38f426273595abeb316253e7b0db5ea4476fd868b11b3c764558376f5273738f950d313010c4b04c0569020452efa6956647de83358be0d9c27d449fb35fc354a88219bb4e77315c1ac10ff26110ae2057b9a54886ba40df3e84df041666e3c427a82f637abef62b1ae167808485367350b56eeb778d383470165b8b3e2a13b67db8cc5112f7e91132619ff5afbe56f5ebd5c7f86a73ccf04776683872664bc470b6288b0b162a87137c6b9f5b39726a97da51dd30001c20fd2ee5884506ada89485bb2f7c4a647c2e5da443ea22ece636039f1e82ca3105c8770f5ab98feeb1d31c11fb3e6cd59a2f75e1f7244a3939f82cd1682cc40f6a83d7d68da7a861dfe88ea12d2b0d76ed17b4211cd650789e785bac89a064eb85ce387575f71c7580a1e324fd276046ea0028637d005f9d633233045b58c8a586a99d29d38a18332b9fa7b7e3797cbd7a1a924bd75b3ddb7dcbf2593fc94b7726017f991b14bbc7ec0781c2b9f24e29d23013245e9a36c6b45adab1a2cf63956326d24c29b5db706ed93af785292c3f122a0cd55b3751c21eec9fd09a7ffaa00b06872e9333e97799c67de6efdad4499d1eec331973ff7d38d2c36f6e150ca547983bb21e8db3ef6f2173b98074bdf39e3d10f9e5d0cfe7f9d4d33cf2a16085bc5561c22b1f5a6c5902e65249d0ca94cf388fee83e6aafe1188a1402fa5f8ae8ba1840ea002be9ab3bd7b40fe235544d120770276f92c77883511bffb1a9a81ca5128c23c6fe6bf933f7364c2f50c2de7121f48536f779399bdc6fb928039d7b2287f8aff4c6edb5946af860479358e9f0813ee4cc117fbd838ae74f2989a5e6f64453bf18a7a421f58e3f76b461b2b63262020d564d298b115ea780b427f58de32eee1d96364bed3ca436f081a61a76625716cd2161b6a5992615c8eb30eb2a0497e0428c83a80d536b2258c06ff58253b1a2f82816857f414f270356fd728ea51966ace70dbe216a284f08f67b334733d5808c8d514decefbc68ff5d2f454a1045f27fdffa9bc743ae37ed2b7cfa8a83c77aeedcb47600c1dd9d062fb9afb11ba549a85fd75681fdbc8aa6817e7d8f7156e60ee016142063aca7ceb5501102b12dd4545804ee17f6697c03116c91c080bdc98bcc6ed122a19a59cc4f5bd266a0511982af91ab0ef1689557c90846fe71ff05cd8b5fa17eea64f9746d0590220dcb480619fd3b2fe7f6261c6cebb7ec5389913a82f61d410de5dda86467e02bb35a2a8f8ed7e796beaf21c8537e04c6e11f2be4adcf80d7f42bf80bc1782a1490a386cb9dc98a00f36d4409e3f0dde260d0181f59f53855a0ddd79ea94eb734e73dfbd640e78fa02f6e27258dac80ec22ea2cc30f52623fb23fd6183b4f84fd0a9641adb1dfac253e16c5da8d39faa6b308b455b85d7cb0b9b842fd5f975654b580809e98e20bb1071ce967d130852d42df5c3692b36a745306ed040c6f0a4dae0a0c4df54bf22fe6b6bfd94d400b4fc01fe8fa9b5fc060737c1b77585ec67a250084af4f9e87915b5af3e933dc1a62f1e32780535cd20e22e36a0535e0b2cd80af6784ece5d88bf77066b5ac7117154283bccdc82b704411a42690d6eb35f01ff005610165e8bb69333c46377ed730a01c8abd5a9cfc7ad4d537c78ee1270ba059675b9f2134034fefa1c9cd0453f31079975a7c727d1169f2d52e08f820d83f01eb5ec8a5c4b848e79b7759ba5a4c112da24374f938109a5207f076f3d463f8420b4ce29c7c2a1cb1012969e3901b20873839b1996074d26379ac62b40c15e5ca1dbb81dbb60133989f4b5ed20754d332c1b513454b89573f244abfe81d4cb7d30d203c7e5acf73e42001ebdd89f2b198d17e8fb48cd6e35666ed022130375bd4be9d446a7795ab9c5d99ac8704a0114b7b9de00aba48fd3cf97331709649d319d5f2c429f759a68cdeaa4a59d62c00e59c256325b85d674a964bb6a8a3a9dc5b4ed427d391a338b86b5f684984f0d28fbe7f0d4b1daf3e3927e75d0e55f4b00f88380e6e132ba6c9dedcefcb36f982d66b062c372b68a8127df8007389bbf537498f38c8d114ad2f72aad668452f233361a121d88c22247c853fc21f72d5e578cddfc06add0ef7b4cb0f7b841807723ce12d2fc7bae7eca2f0858bf7ec3b6010604e6f88bed5e5c0a6bb2ce701d0e347215d45f2b8b898bd36ef98c6c377496dd8aef60db4d647597f8a3aef16801324bc0905b9d0c539e50a8308a065557f273e5d0425d33e05be08e3f56a724052f4524979bdb63a384efb2e62fb56f9e3ebbb821605f0e00748f4b58fad456c10ddbe7f880977eb8f0ab9a901243eab679ffa6ee3069792cdd0cd2e06a5b34b71648fe85a919f1644acd3e8e2beac40b2a5483ce7807f4494427e0190ca5ad982c3292e961080305af60837411e86568790094edb46122ef5371ab4ecd11acf02c09ee4015d2f4fb80dfa0b309c653819ed5b599d0382eeb6a0caf77eb942b493cc182ee2884d4353794ee49587a7b6c3b9c093813422390e2ce9c5ceddd02452ee74eee4c9e67f70be1516d7167507aa649bbcf3726dffcfb596e36e24cbdc42e55d7b304e998822640af60d71c036c868fdcd6e99c19c35ff7b19fad62b4eb37447dfb62fb5a163ec13aeb3f1d4094487cfaf19f2f89647ee196904b50db8035b2d4fa59e533e3b7217af33b70b91d7fa8b00c1f67e4c3cd44addbb975865226b818b4dcec0b6d9d124d51d822101084cf8d52198c192a752a52d97ded183f30c9ed14866072551bdd39e9e33cb09204f72f728912767f835a9fac0c994b5631d74cbec8afe55311e8dadc62dc27c0a752b67df23526ace2fb4050e3a2c1163c4744940ebecbc0c04b965a255fc903d6610a82530a69b047ec935680f991f0186770e6713818ef573f38e9c57309f1bff77e973d49f096f372e55674f8a07901c564abb977c83be34baaf09762e472079f466eddf1b58659eedb1091c6c2e514fe91607d57afe0bedcd8bd6cf374f17f630496cfcbfe22122ca314398087bf3e214e734df59132914f92228bd5a463a57c682cdd6c9f8eedbac5f3f434e9d9218bc92f39a84bf769504f1f8947fafba65dcabd30696539f51e8407242849f50c660a7302951d618e09306401d9889b7c95b17980c1b953c0712728ee534c7308ae75492e6f861c4c65adfafeb157309228d46122b84d1bf3cc9857b15ee7630412aac1e07db4beef96aa55a33d63035bd3d5f8f6585a07763b17a0ebff2aa00c5ee96c960d6b86979fc8811d4e59e7756607971f3d289e2cd75be926d3c0842e202da7f7b5df43df989be9ac31c10364a9f26fad51a85c511389e6e4365d71129c23168a336d4c5b7cc674519fd8f91cbdacddf237352b726fd412cf75d5cb12eb789c284ab91c01394daae98fc4c60053c30641f9a906cd970f66ca7a27cf0838f09282c96e1e7a3368bd2b1eca98aebd797388e28daca5f9b59c4458c28a3be65f2022c45b6dd5d7efea2e442b672609b125ad2bb5775b02c73f63a8973f2a9e649cd10e2d38c616e51057392630315e6d767cf8e544b3dba9da47b8e69184f7817666e6aa539abe70b5ff086ef01c15ecd9b687d61cf9e2a07614c7233b1876cc8aadb5d24c210519b63e71a88fd0cac279883c3dd4a413533d231bbc701b1240b8554aaa633910599e68b27af0a5d189e222f34b91e7adf11db0e05e429f2e4bc0c80b21d218f23d2c7818f66272f3b94abd4ae71f0dfd7c14b6b1efcea3b10b9c5d915366942ae76b6052ad296ef41ea3995ee7544ca1d5b3331d461f33fa2b83d65f5ef8cb2e355bcaef6010cf567ab825d3aff17e906fafaa44c54d27717ae20d4d3f553125f085c91f52a3a9663881bd1abfc65c1aabede70a05d5326287473e2ceee2dafb5beeafbe3bbd8bf6aab2724f9c7916c9127676667bdeb2119962b10c7fd02247f8b565a4bfefe8d9bd80eb346aadda92e8c442f50ae6847f2d18b2209ba2142adddb1865f138c0667a1e24e0d17eb4d4576a2725fee0b2443dd21174f24a4114a6e5e4d930a2325889d57c1a98852dbd0596b0916b8e0ca68d4a998aa9675180a5bea087404432506b974c85b81fc6399f6ce1bb55660709eb10e99b889321a668bcb37ae47f53ef419ae75cb449439fc687a25e4c8c0673c0eb4465fa9cb1055fa3da4ecce22b2935709c79fecb6896e2d19489977c3479732e387e19e0a22a39979306b9d16df8750598373770093f05e856f6c878bfa5d13c89a2017c0539152620b87a37cf433f392e64bd50bddfdeb27cec0ece3e7bcbbdc0b8fd4c76cfe2eefa7055c7d01b85672b4c7280938369a4bc88cdc99c0e767a7daabd40a5c42b5a5f369622920dfbd8959afe059df38a2add2dc74c3efce90ff479455cfe359c5d67761a347b67d75b43b1ca3a9dea0e6e873a72f59e09fa0569550c264807959258dfde42783e4056494eb3ef19868c7e55b15d77b074ea94dfabd9f6c69899b806b09297e7feabde5d7eb655c6caef04eaff7296083c92ce8a5efc6a4002d4f8cedb31d1c5e393ad10344af91fce80b6840a6a3b3968b69eb35a1aff394de245981469c9687a15772260dbe5f4af27ecf85cbdeeae4bf2638e1bb2e6a92f3764bb75c79b590a85cc7fef175ead8538f7c04d23c52f5ed86a4baf5e80d965c5063907d01991aa90bbbeec72203f724f36d8e043a694a4510cc5dd3ad272df34ea90f0c1f29af70cd53ebaf4927d435a4c789213250ea6f7c8bf1b181d5ce565d496a72366dc0afac17b88bd862839f4ec6a8731f7820a9dad42589e626a2857fe98a1b38cbbbd46be5ffea8e3da9b09b6336d6fbe03",
      testAccount1.viewingKey,
    );
    expect(height).toEqual(decryptedSaplingData);
  });

  test("returns empty list of actions when ufvk is not correct", async () => {
    const zcash = new ZCash();
    const height = await zcash.decryptTransaction(
      "050000800a27a726f04dec4d00000000a6293a00000000021690546cd26e6db813142ebe6f85cf1d526693f31ae575b473ab8732558911d8115568656e8a9e7a608bc7baf845114e1cb46d25fdb675ba022ff426cac5e35da02d26d53dff40661552ca76cc444af4b5ca121fc364c8126e4cd8039e3021975a300d5e9fc9661698bd149ec49a077ce9643d0deb792e471799d94d4530a8bb01bcb988dc2ddd8fb5030e44b4b6533c965b7c82516e3539da5578e27ff2fc30c47ce646584653f0fdf8743bbc812c1fc32aa6c2a2a04111c63067f51d3032befa669de4546986f70addf13f4faf31dc52a03aeffd45d8519dee687f68ae904e59fdc1c20d76f2267b82506d08810eda92993284fc5063a40818b83fdfcaa8c24a8f735698a384eaaa49bcf84d2868ebd47247916b00c77641b01019a3181d5c287bbd6c96756337bcd15a0717d7ce84346bfd30e32d5269bc79b664ff6de072e2259c283b13558fc568f065b4bdaeb69fbf4a85898b603263d6eb95914d72b224c72dd7bb0ac22282ac9b60b647351c973319a4ceb0ce9389a83ca7efc06e31a6ab0c76de6be4aa0eb786be646bc094ed2ac7f6901e07035c60d491163589713b69ffac244d2b50f2e8dbe14c8b6f77a1b1453aafa2b6182229084dc6227824ea19afe71677aa4243cc5fd3b1de6b190552f7db39a20eee4ccfcf02e6aa50d129cef00af8559332a61847ada5f6d0568348283aeb76fc5e5844ef56b0c2b8392b3e9f46b9db0fb1e819fb6b31c2776060056dd56d268e96b02eb819459ff6791ec3a6b6a85ae7aae1bb252d3c32c83b22adf2e5b64325654c5e1b67f78da4cb4a8f52e7735851806c15639a22329d6bc8fd9cd1b8545ceb397456299050daf65729a81a66a2ac4a353d690cd43d79b0d032e3f801590e3504aba3d9c6a751fed42970ab3217f0b165f3bfdfa7d4aa910bee648457b0e100e0397d2e4890cc16a54ad9801feba09949788b797967cdc725dea8bf1f3b6feb1d756b7f8c25af9e78037460ee1158b016b0b83c1786c51f2e466488e96db93850f4c77b2df448f74ddc2cefe4ae9eb50e46e9d6eadadce9eccff1ca6bacb197b6cbcffceab1bdb51eaa8976f28f5870feba9e632566981b0eae2cc305d8c5f20063ee98c2cb99ac5caf0b69342c59af863f8ca4a956dcfd5acce26cf268deed0ee477380958929347fede2355aa50425afd24f2f224869cd09cb01731b0828e8c8cee0dfb039bbcf2ef0d9fdbbbf2c28afd6757ce2a8ff2986a4a40a6bfae7140146d75e1cc34d12af10bbdcad93b7fc71cb4d01c5391f1f08e0d44a99f23d93363fbcaf44f79fd3ac29696c8b7464ddee5d18e839d5cc39ffb53f00dfb9fb5e366066bc0dc0ace0d866b6596aa21108633c31ab7409365dcb13b32a446d5e159aa6f6e78645e63763935221ead9a53abdba851f18545c73a9b62c39931747910488eb9d98007b4316322addf4a78b1cadf1d34c53ac9e95f5cff1cd5c32ba39884703ed6330a0f38487a0a4fe1bde01220e29a4d3fe17702810e8dd065c72f44c605d3fed4d01c983e7750c5183c1610d98d1db700d4d054540288a2233c2385086f9856e57f16f9251a52c60dc45c8a8897ca243c2d796a411828b7efa98067e41a59b78e2a1939ef03bf820048f60345845055d35b379be86091342ff909bb7cef5eb975ebac7dc3f6cc88696871710ec870fad29278e0ecc28e1dc5cde442815f048b48cfa471d88bc8b6b12f2d5d45ccff193b8e6c52fe23e2af918bc16cdadbdfe6a95d583a3e45433c3e04bfc2129abc5786753f7d9a4113b379e2d0222d7faeb4cc2242316d31c91514622834833407c40637f47b1ceadbac4f8252d7cb179c4ff25f80c6a4a7647539e22def9eb0c25f4fb806e099d1efa4f181d9afc367c6d438a6e5fc0ab3ec6d067233d4e4fe1e4310dcfa7242627be3e173e6386ff67b13fe80c1970bb8a41563e0fd081b401ea6b858ea579d47deee075ccab4a54248be2cf645f4e50cd4095dce2268e3c8a4ddb929db526fff7960d9a8a1d009adaa7d68111a269a75b59eba9f1cfacfc7f187324831a39aacebb83c53dde42cb5cf00ade06db91dc2b2df29386cc1e4ce77ac33fdce9ea6a2107f077087293962790853bfe7060185c535753503c0bdf0ffffffffffb3da3e64a0879845e7d039992a034713d159c95d3d89d815ab50f3390ddcedef7271a5e6a611618ada58f0c028c44a41a3ace5e8229a13c2d4f7af1d72202d73d1bdb4d0c05cff5a5be83b922571d1d10354e09a7b03483f963fef4f6e940e711177933c948009ef62b53622530717baba8a4490ad01121df87eb1adee592978d645b418bb85eda2c934685fa000b69db25fec9c3d2eb0f65d878237814d726215d8bdccad1d7f697a8005db30000a43ddd2dc483c1c66a419dc9e154b8430689187e6ebc1a93dfcd4422b1df40a41ba5b86c957ecd9966d6915aa1df00e2debd2fc4fea12880ae30ad4450cb8cc23529406f5de55f3be3eae838a1c5b7d39d1b8490d8c51868f73e793da8706027c699e53c9a4d5b48fb1b4a42d3e170e90d00a8908f9af7037f1cc28abee6ce965c284516c8111857f4eb6a5f39512b7736ff9265baabc9c03720172c73553e515dfb85bb26179e648da1606aa1663c82fcc4eaadd5fac192d7a41641e3751097ab42434f7cb4bc974c290a14b1e48df5bc566e4f1940964972c3227fa5e103962a220442a813c5f30f063337de014838cea34d2ca3a34d8558321ffcb9f910ff03dec73ce9192340ac4d7244f731fa54a0e02277732c68c1284fc18184ff8e19314fa9a76d81fee29cd5bac23257c7a47383a1f4f484c4f08999caae074fe19d769e8129dfd84b2d30030f7dfa1f8e8700d38b25f70393160e3e6447da0877c253cbe74c9e36176469fe9d701054d30242b38f6193e0a8079d171c5b870651b258aec6b2afc8bc35add4d8e75f94b9caa292c818971bf188dd7e98a1008c922b7327aa8e59b239cecb02c77ffc569e3591081e26a5ed0f2068b14e437b71f2075d4a51f92f5a60e96af5d965636aaaea5829e25b65bc2592445243d0f160792971ff27b7f517d4892153b8e95c345e5edb7543d2f8cfa50752db0dd114e82f50182ad2a10789aeaca20eb383b17b12ab431bde527de167bb1fb097b2f84a57fdf10c0423c80513059c85330d6159e78a46a8451ac731e2f26fd2e217d00e5c13e9f062386b192318942ee1f9181c4f4e75d3ef70c638e2c98a1088ce58e4d8fc22cf070322921d2ac06fdf24250c2ae28be258434b6673a33cf1d87cf65f4a4085d101a4ef2db7824d1e07982a562075a2081dc3cc2b70e66c444d581407722ac96301ed0993165a574e13655a9383c0549e0ad2b202194916f11152a02f65d487e1b6662b9ed9637c83f07f46004c8f9d853d444532c4dac5ccb193ab98a4fcdb0cda57f2ec79019a4d09a3a31088451c6de1026a0f94e1095e3b7db408a39bd67f345099a1c63d020f2aa81d5b05e02b436c2e24d74aa8f84b9f3b29f204c45314b1f65f57135c9ceb82991578c9ff9a076ae55af6e051b55b823720aa71ca08a7b13444335eb1dcc51c391c99bc5347412327550e998836e6534eb4314a7da55678d949a04c7dd2489385192a2d1976ae935193faa402e852eab40c775672704b66c389b6b911be95102e0c4d8ce988afe85663bac10aaca79a2bc52babf52f86f1de6ec6afa3b0cef14eb8031837e32ede476573480d9b1427eda50b8b4994f280acf40f36ef348894bded313a83d6dbb624f263deb35cebd8a7c2ccc07a4be5b5398eee2cd2eff80af3d59534503519a34bf2aec4f453be65fe3459ff50d8d025c378d55e08894e6f4672132a5061c748e9e61edf1254c4c51f9a37f37a613dba65d1302fd8ae8faefd8f21605b93903c29919f1d91e3518e51cff3dd40f685d941a3666a34d416014798ff98854c2fe7d0348f031bd079d3704a7bd098fa2b6bb1fbc0d6dc0bee6349afd2bb16c69d2889a8fd1984ac2765ac85990ce3b9c2743bf4c3a20cbff29b288409e287983e1dad257f33aa11093af0d0d52d8ee69659407c38780b2a70613fc94dd762b160e152b592c570470e9da118a9aa78ec8e18ab7263b332b42c1d63c525b48eeaf7c9eb330be21ba9938560af50e1a0d01d3f08df33092e3fce211277b6222e1b73d4f3178a6fb5a93e30fe30cba781a27f5eb71aa9328018432dbeb16fdaa61567bd3c2419e7f63852253077ab3fa30a8f474c503842997b4e84b26eba532b6afa16c665b170df166822a847d6b835bc518e268c7d7bf1e7c41e887df6dfae2d6382ca4c432c6faafb090ff79e517d53a2fb357d201978c8ddb745b483c4202f4d3b45a041c37484218fde27ae170ad2b1663a9007abade4f66d52fb873cd8e42756f2ace3b55ebc15912d462f85f56846cdf0ff1b729cf24eec702a69da93d1776fbd106d8fa32e6e627618840a629084faffc8fb241c17924f54ac682595f874f963c183ce5177cffa5280c17c942a63e8e1aa6f5058f082f9e268ac96c71d6b6eeb782bc1a4634468d5ce8eb8075ee71c1ca8a6dbdc903e47fc2aa3bf59dd9f1800cafefaf1a615a88014f61b2800c44119c1949515206b87b124e15fec2cd4244c2d4f14a9098dcda5c34bb328187d85cba59d0df8309a1b8c626da0329f55007efd560c08cd79720d3e59a5874d438c723cfc8f424ec05a2f4015f92ca26211ae44a581b45c766b0495400179ac357a1e44aa471cd06ee964833556d21e0d609a03b172a7bdea5d0683e982bcc60b683b62c44baf7997197964c2da2d1ee938dafe805770c8feb161e11ed97edb2960d2f191ddf7e88a7d492aebe677f62ee92eb10f1e0fb687d32fb6dd5aef5b6d138040ce2f0fe11ce23b31ca0da0950703ed2f020810cae9fba8dc02c00bb8ae936f4d82030bb7c9ab23da5c04b32d99697f53e7265c43e325b3cdf480c0915761056640afd3e7d9ab47c75664e8addfc590a7afe243f02c0b583d658259d6d5963198c30c5768e4f345c1bcc2c453d1dd0b1a6e964a7f53234d3d7e651dc32a5add95c04e81d7d249821962828545f15c614c14d92ddaa930360900f00000000002281e07dfc77d1d5c77803d3f4e3234113d3d7ec0625d942ddb5e0106d3b9a25fd601ca1119b9f0eee0a67ece53b362afbd3aba8cf944a0460fd33b9d32085220f1a2dfb6e4d0b03a8695c63e4b4f4608d54047edcddc1ac66cd0196b04acf4494833d664645ffd1cfd8dd401bf33ae769c66df17362989bee3f09b618f560fe83b935736ab3a1249145b2fe355ba67a137cd38f3214aba982a75de97746889d1ba4244b64589f03ae864c082657ce92cba4696a1210135b379c96f6fd2e60cac678ba2aa059a9044c29cd7623c04aa85b765919770f096ff7813976ac0556d099a18ddd95ccb15a86ff41965813d5701fbd507a4f598ecb6e6afadc9e5d6ed09e5e8d5551b9ba296145e50aa044dac915c694f9f75f310bcbbca96327a8f0db25e1b0001b0a0e13a7c71ccdd6d6ea443afcdfd5e7c75869b799e3cc781e6c106a87389f48baa90287d74c4dcfcc722c63d713bd466f80d30239fe5a7ded62aff07e1698c65abc3ee29c0b6c401317d50f685922cb16992d0c073f9b901a5000509b10f99d95ac21a57e099fc3a726d2916a0e4ec9b0948cb34b4b46607aa06e797387c82cfa37a2215dc354c517b87e7d7a83397c5ed7e203d9524556ca1813a9d719adf17c79a541b51be4403372e3072b496cb2c3c44a1b2e744ea7d60016672c8a858d23aa6212500f6812dc2b347bfac2335e6b91c05280023781aa12c80494871ab856a0da222f18fe9c64bec940ddeb0b9a81cc90079121714666c96a32181d3f5d87b3eda92edf810c6c98069d9fb54d1302cb9dfea191309f290b49e2c1284e47dfc53e0e33b16d84856bb78c428b4a751c4ae7dc670e141ae3761b0a56a3f8b16a7109a0694a3a71ef6bb9eb0895a81f0176d1c8f9526a40bef9f087838ffeda9774bf54cc3dd91eb5a4b0fafc13553d1deed89fec5661bbb5db6d61ee89f510c3090eb6a244de66381d60806d275c53c04ea9d5a783c287bc6d94415608fcd7fde2b0761aa383034f7364a7363f58e2b8a14c6da8eb037dc4c13bbcc112e66a2c56aa0d8bb5001f6aef0c6df5d91319e4de2b0cf009c7c8e8ae04b0502f9bb591336deb92df0fc34c59051562cfaa4588a7f2cb83656cf2964f2661b1947a48805f82d9d55a1fc88127ebca73fe304d91aa5d9366f466057534cac10402451d5d24b770dcdb1fc5bc03c6cb7d81b29bda41be4cbea154521ab8ee68ddb0f264c53de07763b5bb96f3cc7cb149715ce176f9f547ec9d6f0da76eedf818b7372740b24908af271dae5d27375484603e8ca5fe626ad83b31643d69aae43184019f41bc324d3d8618e2ffd2d4a7e5ec4e05f6ded7144f065151b619221ec5994c78d0777c62becc5001611614e4317c1adc2afdec0112595a2edc85ad221b1b8296dafbfdd1e7972d00e68e0fde50631c8b092fc347a1d0c4cba039ee20a29ce21584628d3a2946dc543b3b8d366115639e9cfc8ee61658b44effb8475779bd41f95b3d9514f68d8f432b6a43fcdd18e792ad2c21dd6a120fdcff97540cfbab98c7eea658ccf19f322ca22526715574e62c0efa92f4e888a9962b6f8e9f43b381cbcfa228124a2491aa8336b50b28c23e6e07515f719681d667eca0a45d65012705a1573cdf1adf5630f4b13cff62f97bd7fcfb8c41fd923736773679799707895e9c3ab494ec76c315a5abec5a5712c9d48d167d379f4095202bc0cdccfe04d83e12de29b7a9bfd41c9059e0a1003f95461a748d3b5f06529568429875e2b3f6c11d9c768ca4347d946ce3220269f5840bc1c15e39df9b57276d2762eb19233da4a7b6b4de52b09c9f11a2147b652a66b4e31fcf9bc6fd85ed78340857302d880391224c7ea17e6382cc3615fd61c1198be5296dcef5285b6d4990051df918ef86569ced92d1259e6e6342d7de5e6bcaa0b4500c9a6952245f0de11f697289e41eafffa68392dba489e0ce76389c66b347ae3ba340a52dbe74f62da5bd41bd7d5fdbe1f855483b31620afcbbecf85e1dfed50b94929b93b602a0ee86dfc021ae942a9284eecd41c8b28e09c3aed89ec363b50f4d2b420bf58b31181a766717dea8f814e74ad5f90d60fe4ca16985e67eee39b1e6ff2e9caee0ed9d4f33f8ac329f04806e547746ca8c61d5ea9f237b58d5d5240c07085bf710bb8d4ca6a61bf98a559155c3b1be81fb3853e292c53349b3e35b96f7d83f5f6781848d489d9cb5f4eb9874b342c4c625380c40e7771cb29b40ce9fff96b04e0f17822213253c9656bb4c7a7881284e56274c8b5c0de488cae76dbe6b4b06a2446d049aacf32d2fbf899bc2827e7080e899aca560f435db97724d0b428b0f9225df922f04f40c2b29d1a44310d72d26a558de437a652a3939afa4b79b388d0db5f9e5fa8849b98f628330b65068544731fce921a8dbb4e72200f31c75a9080fa9586dfce33f08d199bf6975dae325075fb663fc5ec8a9b4618dd9bac20fd1254a74e04bb1991376873644c9133d5a5ceadb8ce13f8a985f6951dc9b32c22fd44cf28e1d261e07fd32932b2d1067a6c2809d6922e5137d9dc79411c143d8b007ce4186b55aa62d43eb4c87441f4e6bbba9f7f7685e32f2dceddb767e5df80b3813a03eaaa5a41b89422dadbd868b6a6d45328d7d435e864864ce3177e4d1f1929913af3d5ae7305955ca1a0c2c83dd72a6b24da9f58335a99acf517b55d8ac60b5270abb8a7d0d248eb7fe444e0242ac2a16715483e827e529c3ee7badad9520bc762a16b85012863ee38f65434b75a97e8b5eed0962046947083606a7b4bbc2286e69a691aa38d2646c1075492a1ad105081b6518ef00560aca52c217b05fefbef8e461368310449f53017ea70a24ec5fbd88343b007dbd4df330eec040f65708fded16556811d6135ff5ffae94bc967fc98e8596411defe2bf5f67428f9494b0baa6149e5f13b31bbda2685877d2b4e903d36a10467edcd0e462bc6ca4255707d8f2a6fd881495138244d4de61577dfe9717f66c42d4001c00f1833bad8650c6394a42f7992b21abddfde21342218309f5152d7257fda8d8d9d2837e886b2ecd4baa62c7fc029420ad33bca144caffab917c545037e04dc8a28f32ba5994cb0f21bd6fd31300ca07248c0c152200afe43b7b6ef66086244793ac760add2869772840a90e91022e5431ee288b08c889f4b76a59aff8eea78bbbf2c600b674dda766439a01783837c9e9bba9ab9a0ac8a5aa226d7fc1d7f24116f81493a391b1f62332c20fe537c09f382a92e9a69ea77a5a1e7b83658797159a0bb0e546cedc8184cc1b79e002a929431ba4df75df16b7e55c62f996becc55cf544df4fb9f55b6aad67e70e93fbb23b73862ae41e680bc906c925dc6bebf9295b39d7e05d43e8bc797166782227cfb3243e6c1614197777b0d4b3333c986702d90f520989f4b9da0dd867cfa2dd559dbd0f602e183e247bb741d648f5aebeaaa23ce9c982af840e7ba4fa3053264165e615c7bbfed6a8aecbe9413890cb153d68819b553d5f9548a6b2b2b4e2d1239afc20bb7991114e55634e900a851c361133ad77bcc04a885d885147d331b54468cc0511fc0e1670f28fecbe5534043400483af7ce7a202076aa024ea762974c71f82ce9ff302abe57ce2d96f4d06f5540bae482ad83081aab35c78feaa3287f8b11df94bd4cabe80f938aef6ef44c5217d25015253240b216962ec5473101379d92c486deaf78e221b8af7cc27dfb2ac897aeceaf9a7434cc551ccc9b83c88dbbcaebbb4dc4c62af0626488c4dfb5612d35ef63d22f5266d2d919b767417e8712d450191c9b7bbfe9b157eef39e48a3671a703ab667f9074803cc2334012bd55997b11423a8b941c53113e645f98fecce3992015740650b4d212999ce6146d13cbdeca3d5e7c548c7e4f623a29e01af5cda44eb6edfa8706db63fff70c359e14bfd83412641d8b0abb829fa8ff9653a93e059170ad1b2eac9130c1498137f5be79ab12b331ead9e1f21972f1ce90e879108a17c4c08101f643d2bc33e71e85e37b4f1560144e3677bbaa1dd4ee49d351cf67a2bbe84703fcaae0da080f037a7af5946c1a891aebbfd690b502bd79cfd2829a31daa6660bcd936550d56d01fa2a46df83f7d3fdfd98d50d65c0c712ff274470d52cb4da1070cc4fa8bd8f3a110a87ba790727af6d09acad0c838cef1ccadf452e914feabb94474ec6c76d1085a276534ba835a490d923df662332debe0721e4fbc9ce1c3083d344c6268d1278b97c80c2dfb168ce332b86fc9a8141458cd0d704376dd8b1419c409291c229e5f8fc88f1668e7106b9cae31412610cc30e92a69a0ffd2743bdbf1746c22f18af6e7b4375d92b1ac20da26751f431f5803aff6a88a42f0e92cff9f254b0ee2bd16836010a0a12b4a14f99575fd589251fd6c1e2de3b6ee07483400c1ccd7337728301569069b1065a72bdef3bfb09835b9fd95e1caf1304c7162b4eabf27f196d246bf47f0ae46c07a51057bf5340483a5322244d6f03daba481250d7d6872de8d0934f98e5f77323ee571f9e0a75571be1c1a80cf037c42e7b848c8814913f65fc517c2b6e960f3e5a156f08bad12524966fd5e74b9d68128d85e0844009367733187962df33db1d196f2f64e823a585be79b81ded3afd4699c12c7a939e1e249e2747e624163c428001840c656b82389bae0a75f940d44c9aa03c54a576224cc659a4abac6a1a6b6e8ebd77ea02992043c28a80cd789826caf152a1f66818583c45dd32dbeb7066df37794c0c839500279916bdde7fae413d27df5141d529d3aaf2f3428929b8622a0a0bd46a6aed13883b30c453785f60d18f1bcdd10822d62083ab726a9fff5fdb2d83a2c89130ac91644985ae524d00509eac52c37818be1ac4c2bf9435de08a430957974cacdee6742ab172d2fa4b65871038301372dc58bfc9c9fd3db4aed3635d631518b20397695968047ed8672012760b122483cf9693207dbbaed34bb1e3bd498eb014b5055079fcc12b5f7e9eb46557f776623bbca8fc954b7eeb578af72b252b56fe307bb3de3720f7ba9b4f91d72ecc9fd27bf5d270f7945d12643d46a842b57d85498bf1717c58bbbdf65f84e50dd456e222eb2d6d7d4ee170e8f52e54157e87c28c8b317704183aea1b1fcf697b520a4283d9472d6cc4c3411853da19b048c15332e6f1b5f1e99684e927796d4418d3a3402f4fe1d1504f225881a59447b55c0a8197d28517895fe2c591e641a1576430ec4db6d928c6805138d8f6d7721e95402eb786dc491b4ef4542ed4f6074bb3c25fd092e1b74e6e295781b2a709a4a640cdfe965489e566f2f67f5f51aa45ca90a9b6c4f13faeda596ad5bfff69adf285296c13d8e43c421b4631eeb45c834980e2158f181cc572145b78889f1e85e0ea78434bb7b11bf7c8183c03ca8d5b3c71a641d5299a3f96292a11c29ac1bcc197cea126c5498eef000af2ddc6f82d2c41d284efcc30d43094a2689df863159b79e45b4918ec4678fb584da7985c9e4fa1b25d1b19cc926d5400f0d8aad919bfa755fbec2697474e8dc773b72d1f0177916b88830e758451bd0ee16c89ab8b42635cc54965148799f8424f0916b710a98001a61653255468ce5e43a5d471b3bf5f20f6f14a51d706810cc73c8bc1d3db33b6d4ad9e0d94387d129644635a2236a7475cde95baa78cd77b7d9b6281c53391ab1f1f03d459ffe12b427000eed1fc11533b3f7db80f19d38f426273595abeb316253e7b0db5ea4476fd868b11b3c764558376f5273738f950d313010c4b04c0569020452efa6956647de83358be0d9c27d449fb35fc354a88219bb4e77315c1ac10ff26110ae2057b9a54886ba40df3e84df041666e3c427a82f637abef62b1ae167808485367350b56eeb778d383470165b8b3e2a13b67db8cc5112f7e91132619ff5afbe56f5ebd5c7f86a73ccf04776683872664bc470b6288b0b162a87137c6b9f5b39726a97da51dd30001c20fd2ee5884506ada89485bb2f7c4a647c2e5da443ea22ece636039f1e82ca3105c8770f5ab98feeb1d31c11fb3e6cd59a2f75e1f7244a3939f82cd1682cc40f6a83d7d68da7a861dfe88ea12d2b0d76ed17b4211cd650789e785bac89a064eb85ce387575f71c7580a1e324fd276046ea0028637d005f9d633233045b58c8a586a99d29d38a18332b9fa7b7e3797cbd7a1a924bd75b3ddb7dcbf2593fc94b7726017f991b14bbc7ec0781c2b9f24e29d23013245e9a36c6b45adab1a2cf63956326d24c29b5db706ed93af785292c3f122a0cd55b3751c21eec9fd09a7ffaa00b06872e9333e97799c67de6efdad4499d1eec331973ff7d38d2c36f6e150ca547983bb21e8db3ef6f2173b98074bdf39e3d10f9e5d0cfe7f9d4d33cf2a16085bc5561c22b1f5a6c5902e65249d0ca94cf388fee83e6aafe1188a1402fa5f8ae8ba1840ea002be9ab3bd7b40fe235544d120770276f92c77883511bffb1a9a81ca5128c23c6fe6bf933f7364c2f50c2de7121f48536f779399bdc6fb928039d7b2287f8aff4c6edb5946af860479358e9f0813ee4cc117fbd838ae74f2989a5e6f64453bf18a7a421f58e3f76b461b2b63262020d564d298b115ea780b427f58de32eee1d96364bed3ca436f081a61a76625716cd2161b6a5992615c8eb30eb2a0497e0428c83a80d536b2258c06ff58253b1a2f82816857f414f270356fd728ea51966ace70dbe216a284f08f67b334733d5808c8d514decefbc68ff5d2f454a1045f27fdffa9bc743ae37ed2b7cfa8a83c77aeedcb47600c1dd9d062fb9afb11ba549a85fd75681fdbc8aa6817e7d8f7156e60ee016142063aca7ceb5501102b12dd4545804ee17f6697c03116c91c080bdc98bcc6ed122a19a59cc4f5bd266a0511982af91ab0ef1689557c90846fe71ff05cd8b5fa17eea64f9746d0590220dcb480619fd3b2fe7f6261c6cebb7ec5389913a82f61d410de5dda86467e02bb35a2a8f8ed7e796beaf21c8537e04c6e11f2be4adcf80d7f42bf80bc1782a1490a386cb9dc98a00f36d4409e3f0dde260d0181f59f53855a0ddd79ea94eb734e73dfbd640e78fa02f6e27258dac80ec22ea2cc30f52623fb23fd6183b4f84fd0a9641adb1dfac253e16c5da8d39faa6b308b455b85d7cb0b9b842fd5f975654b580809e98e20bb1071ce967d130852d42df5c3692b36a745306ed040c6f0a4dae0a0c4df54bf22fe6b6bfd94d400b4fc01fe8fa9b5fc060737c1b77585ec67a250084af4f9e87915b5af3e933dc1a62f1e32780535cd20e22e36a0535e0b2cd80af6784ece5d88bf77066b5ac7117154283bccdc82b704411a42690d6eb35f01ff005610165e8bb69333c46377ed730a01c8abd5a9cfc7ad4d537c78ee1270ba059675b9f2134034fefa1c9cd0453f31079975a7c727d1169f2d52e08f820d83f01eb5ec8a5c4b848e79b7759ba5a4c112da24374f938109a5207f076f3d463f8420b4ce29c7c2a1cb1012969e3901b20873839b1996074d26379ac62b40c15e5ca1dbb81dbb60133989f4b5ed20754d332c1b513454b89573f244abfe81d4cb7d30d203c7e5acf73e42001ebdd89f2b198d17e8fb48cd6e35666ed022130375bd4be9d446a7795ab9c5d99ac8704a0114b7b9de00aba48fd3cf97331709649d319d5f2c429f759a68cdeaa4a59d62c00e59c256325b85d674a964bb6a8a3a9dc5b4ed427d391a338b86b5f684984f0d28fbe7f0d4b1daf3e3927e75d0e55f4b00f88380e6e132ba6c9dedcefcb36f982d66b062c372b68a8127df8007389bbf537498f38c8d114ad2f72aad668452f233361a121d88c22247c853fc21f72d5e578cddfc06add0ef7b4cb0f7b841807723ce12d2fc7bae7eca2f0858bf7ec3b6010604e6f88bed5e5c0a6bb2ce701d0e347215d45f2b8b898bd36ef98c6c377496dd8aef60db4d647597f8a3aef16801324bc0905b9d0c539e50a8308a065557f273e5d0425d33e05be08e3f56a724052f4524979bdb63a384efb2e62fb56f9e3ebbb821605f0e00748f4b58fad456c10ddbe7f880977eb8f0ab9a901243eab679ffa6ee3069792cdd0cd2e06a5b34b71648fe85a919f1644acd3e8e2beac40b2a5483ce7807f4494427e0190ca5ad982c3292e961080305af60837411e86568790094edb46122ef5371ab4ecd11acf02c09ee4015d2f4fb80dfa0b309c653819ed5b599d0382eeb6a0caf77eb942b493cc182ee2884d4353794ee49587a7b6c3b9c093813422390e2ce9c5ceddd02452ee74eee4c9e67f70be1516d7167507aa649bbcf3726dffcfb596e36e24cbdc42e55d7b304e998822640af60d71c036c868fdcd6e99c19c35ff7b19fad62b4eb37447dfb62fb5a163ec13aeb3f1d4094487cfaf19f2f89647ee196904b50db8035b2d4fa59e533e3b7217af33b70b91d7fa8b00c1f67e4c3cd44addbb975865226b818b4dcec0b6d9d124d51d822101084cf8d52198c192a752a52d97ded183f30c9ed14866072551bdd39e9e33cb09204f72f728912767f835a9fac0c994b5631d74cbec8afe55311e8dadc62dc27c0a752b67df23526ace2fb4050e3a2c1163c4744940ebecbc0c04b965a255fc903d6610a82530a69b047ec935680f991f0186770e6713818ef573f38e9c57309f1bff77e973d49f096f372e55674f8a07901c564abb977c83be34baaf09762e472079f466eddf1b58659eedb1091c6c2e514fe91607d57afe0bedcd8bd6cf374f17f630496cfcbfe22122ca314398087bf3e214e734df59132914f92228bd5a463a57c682cdd6c9f8eedbac5f3f434e9d9218bc92f39a84bf769504f1f8947fafba65dcabd30696539f51e8407242849f50c660a7302951d618e09306401d9889b7c95b17980c1b953c0712728ee534c7308ae75492e6f861c4c65adfafeb157309228d46122b84d1bf3cc9857b15ee7630412aac1e07db4beef96aa55a33d63035bd3d5f8f6585a07763b17a0ebff2aa00c5ee96c960d6b86979fc8811d4e59e7756607971f3d289e2cd75be926d3c0842e202da7f7b5df43df989be9ac31c10364a9f26fad51a85c511389e6e4365d71129c23168a336d4c5b7cc674519fd8f91cbdacddf237352b726fd412cf75d5cb12eb789c284ab91c01394daae98fc4c60053c30641f9a906cd970f66ca7a27cf0838f09282c96e1e7a3368bd2b1eca98aebd797388e28daca5f9b59c4458c28a3be65f2022c45b6dd5d7efea2e442b672609b125ad2bb5775b02c73f63a8973f2a9e649cd10e2d38c616e51057392630315e6d767cf8e544b3dba9da47b8e69184f7817666e6aa539abe70b5ff086ef01c15ecd9b687d61cf9e2a07614c7233b1876cc8aadb5d24c210519b63e71a88fd0cac279883c3dd4a413533d231bbc701b1240b8554aaa633910599e68b27af0a5d189e222f34b91e7adf11db0e05e429f2e4bc0c80b21d218f23d2c7818f66272f3b94abd4ae71f0dfd7c14b6b1efcea3b10b9c5d915366942ae76b6052ad296ef41ea3995ee7544ca1d5b3331d461f33fa2b83d65f5ef8cb2e355bcaef6010cf567ab825d3aff17e906fafaa44c54d27717ae20d4d3f553125f085c91f52a3a9663881bd1abfc65c1aabede70a05d5326287473e2ceee2dafb5beeafbe3bbd8bf6aab2724f9c7916c9127676667bdeb2119962b10c7fd02247f8b565a4bfefe8d9bd80eb346aadda92e8c442f50ae6847f2d18b2209ba2142adddb1865f138c0667a1e24e0d17eb4d4576a2725fee0b2443dd21174f24a4114a6e5e4d930a2325889d57c1a98852dbd0596b0916b8e0ca68d4a998aa9675180a5bea087404432506b974c85b81fc6399f6ce1bb55660709eb10e99b889321a668bcb37ae47f53ef419ae75cb449439fc687a25e4c8c0673c0eb4465fa9cb1055fa3da4ecce22b2935709c79fecb6896e2d19489977c3479732e387e19e0a22a39979306b9d16df8750598373770093f05e856f6c878bfa5d13c89a2017c0539152620b87a37cf433f392e64bd50bddfdeb27cec0ece3e7bcbbdc0b8fd4c76cfe2eefa7055c7d01b85672b4c7280938369a4bc88cdc99c0e767a7daabd40a5c42b5a5f369622920dfbd8959afe059df38a2add2dc74c3efce90ff479455cfe359c5d67761a347b67d75b43b1ca3a9dea0e6e873a72f59e09fa0569550c264807959258dfde42783e4056494eb3ef19868c7e55b15d77b074ea94dfabd9f6c69899b806b09297e7feabde5d7eb655c6caef04eaff7296083c92ce8a5efc6a4002d4f8cedb31d1c5e393ad10344af91fce80b6840a6a3b3968b69eb35a1aff394de245981469c9687a15772260dbe5f4af27ecf85cbdeeae4bf2638e1bb2e6a92f3764bb75c79b590a85cc7fef175ead8538f7c04d23c52f5ed86a4baf5e80d965c5063907d01991aa90bbbeec72203f724f36d8e043a694a4510cc5dd3ad272df34ea90f0c1f29af70cd53ebaf4927d435a4c789213250ea6f7c8bf1b181d5ce565d496a72366dc0afac17b88bd862839f4ec6a8731f7820a9dad42589e626a2857fe98a1b38cbbbd46be5ffea8e3da9b09b6336d6fbe03",
      testAccount2.viewingKey,
    );
    expect(height).toEqual({
      orchard_outputs: [],
      sapling_outputs: [],
    });
  });
});

describe("findShieldedTxsInBlock", () => {
  test("retrieves a list of transactions for the viewing key", async () => {
    const zcash = new ZCash();
    const transactions = await zcash.findShieldedTxsInBlock(
      blockWithMyTx.hash,
      testAccount1.viewingKey,
    );

    expect(transactions).toEqual([
      {
        id: txShieldedOrchard.txid,
        hex: txShieldedOrchard.hex,
        height: blockWithMyTx.height,
        blockHash: blockWithMyTx.hash,
        time: blockWithMyTx.time,
        fee: txShieldedOrchard.orchard.valueBalance,
        decryptedData: decryptedOrchardData,
      },
    ]);
  });

  test("retrieves an empty list of transactions when viewing key doesn't match any", async () => {
    const zcash = new ZCash();
    const transactions = await zcash.findShieldedTxsInBlock(
      blockWithoutMyTx.hash,
      testAccount1.viewingKey,
    );
    expect(transactions).toEqual([
      {
        id: txShieldedNotMine.txid,
        hex: txShieldedNotMine.hex,
        height: blockWithoutMyTx.height,
        blockHash: blockWithoutMyTx.hash,
        time: blockWithoutMyTx.time,
        fee: txShieldedNotMine.orchard.valueBalance,
        decryptedData: {
          orchard_outputs: [],
          sapling_outputs: [],
        },
      }
    ]);
  });

  test("edge case: retrieves an empty list when the block doesn't have tx", async () => {
    const zcash = new ZCash();
    const transactions = await zcash.findShieldedTxsInBlock(
      blockWithoutAnyTx.hash,
      testAccount1.viewingKey,
    );
    expect(transactions).toEqual([]);
  });
});
