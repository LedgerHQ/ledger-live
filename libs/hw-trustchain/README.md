## hw-trustchain

Ledger Live trustchain hardware layer.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

*   [APDU](#apdu)
    *   [getSeedId](#getseedid)
        *   [Parameters](#parameters)
*   [createApduDevice](#createapdudevice)
    *   [Parameters](#parameters-1)
*   [Command](#command)
*   [CommandType](#commandtype)
*   [Permissions](#permissions)
*   [Seed](#seed)
    *   [Parameters](#parameters-2)
*   [Derive](#derive)
    *   [Parameters](#parameters-3)
*   [AddMember](#addmember)
    *   [Parameters](#parameters-4)
*   [PublishKey](#publishkey)
    *   [Parameters](#parameters-5)
*   [EditMember](#editmember)
    *   [Parameters](#parameters-6)
*   [CloseStream](#closestream)
*   [createCommandBlock](#createcommandblock)
    *   [Parameters](#parameters-7)
*   [CommandIssuer](#commandissuer)
*   [CommandStreamIssuer](#commandstreamissuer)
    *   [Parameters](#parameters-8)
*   [CommandStream](#commandstream)
    *   [Parameters](#parameters-9)
*   [CommandStream](#commandstream-1)
*   [Crypto](#crypto)
*   [crypto](#crypto-1)
*   [Device](#device)
    *   [isPublicKeyAvailable](#ispublickeyavailable)
    *   [readKey](#readkey)
        *   [Parameters](#parameters-10)
*   [createDevice](#createdevice)
*   [CommandStreamJsonifier](#commandstreamjsonifier)
*   [device](#device-1)
*   [encryptUserData](#encryptuserdata)
    *   [Parameters](#parameters-11)
*   [ApplicationStreams](#applicationstreams)
*   [StreamTreeCreateOpts](#streamtreecreateopts)
*   [PublishKeyEvent](#publishkeyevent)
*   [StreamTree](#streamtree)
    *   [Parameters](#parameters-12)
    *   [share](#share)
        *   [Parameters](#parameters-13)
    *   [close](#close)
        *   [Parameters](#parameters-14)
*   [StreamTreeCipherMode](#streamtreeciphermode)
*   [StreamTreeCipher](#streamtreecipher)
    *   [Parameters](#parameters-15)
    *   [encrypt](#encrypt)
        *   [Parameters](#parameters-16)
    *   [decrypt](#decrypt)
        *   [Parameters](#parameters-17)

### APDU

#### getSeedId

allows to sign a challenge and get the seed id

##### Parameters

*   `transport` **Transport**&#x20;
*   `challenge` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)\<SeedIdResult>**&#x20;

### createApduDevice

#### Parameters

*   `transport` **Transport**&#x20;

Returns **ApduDevice**&#x20;

### Command

### CommandType

### Permissions

### Seed

#### Parameters

*   `topic` **([Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) | null)**&#x20;
*   `protocolVersion` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**&#x20;
*   `groupKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `initializationVector` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `encryptedXpriv` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `ephemerPublicKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

### Derive

#### Parameters

*   `path` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>**&#x20;
*   `groupKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `initializationVector` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `encryptedXpriv` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `ephemeralPublicKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

### AddMember

#### Parameters

*   `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**&#x20;
*   `publicKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `permissions` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**&#x20;

### PublishKey

#### Parameters

*   `initializationVector` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `encryptedXpriv` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `recipient` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `ephemeralPublicKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

### EditMember

#### Parameters

*   `member` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `name` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | null)**&#x20;
*   `permissions` **([number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number) | null)**&#x20;

### CloseStream

### createCommandBlock

Create a new command block.

#### Parameters

*   `issuer` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** The public key of the command block issuer
*   `commands` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Command](#command)>** The list of commands in this command block
*   `signature` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** The signature of the command block (by default the block is not signed) (optional, default `new Uint8Array()`)
*   `parent` **([Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) | null)** The parent command block hash (if null, the block is the first block and a parent will be generated) (optional, default `null`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)\<CommandBlock>**&#x20;

### CommandIssuer

Type: function (device: [Device](#device), tempStream: [CommandStream](#commandstream), streamTree: ([StreamTree](#streamtree) | null)): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Command](#command)>>

### CommandStreamIssuer

#### Parameters

*   `stream` **[CommandStream](#commandstream)**&#x20;

### CommandStream

#### Parameters

*   `blocks` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)\<CommandBlock>**  (optional, default `[]`)

### CommandStream

**Extends CS.default**

### Crypto

### crypto

### Device

#### isPublicKeyAvailable

Checks wether the public key can be directly fetched or if acquiring the public key
requires a user action.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if the public key is directly available, false otherwise

#### readKey

Read the symmetric key from the stream tree at the given path. This function may not be implemented by all devices.

##### Parameters

*   `tree` **[StreamTree](#streamtree)** The stream tree
*   `path` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** The path to the key

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)>** The public key of the symmetric key

### createDevice

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Device](#device)>**&#x20;

### CommandStreamJsonifier

**Extends Jsonifier**

### device

### encryptUserData

Ledger Live data are encrypted following pattern based on ECIES.
For each encryption the Ledger Live instance generates a random keypair over secp256k1 (ephemeral public key)
and a 16 bytes IV. Ledger Live then perform an ECDH between the command stream public key and
the ephemeral private key to get the encryption key.
The data is then encrypted using AES-256-GCM and serialized using the following format:
1 byte : Version of the format (0x00)
33 bytes : Compressed ephemeral public key
16 bytes : Nonce/IV
16 bytes : Tag/MAC (from AES-256-GCM)
variable : Encrypted data

#### Parameters

*   `commandStreamPrivateKey` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `data` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)>**&#x20;

### ApplicationStreams

### StreamTreeCreateOpts

### PublishKeyEvent

### StreamTree

#### Parameters

*   `tree` **IndexedTree<[CommandStream](#commandstream)>**&#x20;

#### share

Share a private key with a member

##### Parameters

*   `path` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>)**&#x20;
*   `owner` **[Device](#device)**&#x20;
*   `member` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**&#x20;
*   `permission` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[StreamTree](#streamtree)>**&#x20;

#### close

Close a stream

##### Parameters

*   `path` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>)**&#x20;
*   `owner` **[Device](#device)**&#x20;

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[StreamTree](#streamtree)>**&#x20;

### StreamTreeCipherMode

### StreamTreeCipher

#### Parameters

*   `mode` **[StreamTreeCipherMode](#streamtreeciphermode)**&#x20;
*   `device` **[Device](#device)**&#x20;

#### encrypt

Encrypts a message for a given path in the tree

##### Parameters

*   `tree` **[StreamTree](#streamtree)**&#x20;
*   `path` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>**&#x20;
*   `message` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;
*   `nonce` **([Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) | null)** optional nonce to use for the encryption (if null a random nonce will be generated) (optional, default `null`)

<!---->

*   Throws **any** Error if the cipher mode is not implemented
*   Throws **any** Error if the path is not found in the tree and can't be derived from the device

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)>** the encrypted message with the nonce prepended (1 byte for the nonce length + nonce + 33 bytes ephemeral key + encrypted message + 4 bytes checksum)

#### decrypt

Decrypts a message for a given path in the tree

##### Parameters

*   `tree` **[StreamTree](#streamtree)**&#x20;
*   `path` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>**&#x20;
*   `encrytedPayload` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)**&#x20;

<!---->

*   Throws **any** Error if the cipher mode is not implemented
*   Throws **any** Error if the path is not found in the tree and can't be derived from the device
*   Throws **any** Error if the checksum is invalid

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)>** the decrypted message
