<img src="https://user-images.githubusercontent.com/4631227/191834116-59cf590e-25cc-4956-ae5c-812ea464f324.png" height="100" />

[GitHub](https://github.com/LedgerHQ/ledger-live/),
[Ledger Devs Discord](https://developers.ledger.com/discord-pro),
[Developer Portal](https://developers.ledger.com/)

## @ledgerhq/hw-app-concordium

Ledger Hardware Wallet Concordium JavaScript bindings.

**Low-level device communication library with no blockchain SDK dependencies (requires `@ledgerhq/hw-transport` and `bip32-path`).**

This package provides direct communication with Concordium Ledger device apps. It uses hw-app-specific types (raw Buffers, primitives) independent of the Concordium SDK.

For Ledger Live integration, use `@ledgerhq/coin-concordium` which handles SDK type transformations.

***

## Are you adding Ledger support to your software wallet?

You may be using this package to communicate with the Concordium Nano App.

For a smooth and quick integration:

*   See the developers' documentation on the [Developer Portal](https://developers.ledger.com/docs/transport/overview/) and
*   Go on [Discord](https://developers.ledger.com/discord-pro/) to chat with developer support and the developer community.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

*   [AccountAddress](#accountaddress)
    *   [Parameters](#parameters)
    *   [address](#address)
    *   [toBase58](#tobase58)
        *   [Examples](#examples)
    *   [toBuffer](#tobuffer)
        *   [Examples](#examples-1)
    *   [fromBase58](#frombase58)
        *   [Parameters](#parameters-1)
        *   [Examples](#examples-2)
    *   [fromBuffer](#frombuffer)
        *   [Parameters](#parameters-2)
        *   [Examples](#examples-3)
*   [MAX\_MEMO\_LENGTH](#max_memo_length)
*   [MAX\_CBOR\_SIZE](#max_cbor_size)
*   [encodeMemoToCbor](#encodememotocbor)
    *   [Parameters](#parameters-3)
*   [decodeMemoFromCbor](#decodememofromcbor)
    *   [Parameters](#parameters-4)
*   [Concordium](#concordium)
    *   [Parameters](#parameters-5)
    *   [getAddress](#getaddress)
        *   [Parameters](#parameters-6)
    *   [verifyAddress](#verifyaddress)
        *   [Parameters](#parameters-7)
    *   [getPublicKey](#getpublickey)
        *   [Parameters](#parameters-8)
    *   [signTransaction](#signtransaction)
        *   [Parameters](#parameters-9)
    *   [signCredentialDeployment](#signcredentialdeployment)
        *   [Parameters](#parameters-10)
*   [serializeTransfer](#serializetransfer)
    *   [Parameters](#parameters-11)
*   [prepareTransferAPDU](#preparetransferapdu)
    *   [Parameters](#parameters-12)
*   [serializeTransferWithMemo](#serializetransferwithmemo)
    *   [Parameters](#parameters-13)
*   [prepareTransferWithMemoAPDU](#preparetransferwithmemoapdu)
    *   [Parameters](#parameters-14)
*   [serializeTransactionPayloads](#serializetransactionpayloads)
    *   [Parameters](#parameters-15)
*   [serializeCredentialDeployment](#serializecredentialdeployment)
    *   [Parameters](#parameters-16)
*   [serializeIdOwnershipProofsPrefix](#serializeidownershipproofsprefix)
    *   [Parameters](#parameters-17)
*   [serializeIdOwnershipProofs](#serializeidownershipproofs)
    *   [Parameters](#parameters-18)
*   [serializeAccountOwnershipProofs](#serializeaccountownershipproofs)
    *   [Parameters](#parameters-19)
*   [insertAccountOwnershipProofs](#insertaccountownershipproofs)
*   [Why Insertion Order Matters](#why-insertion-order-matters)
*   [Serialization Order](#serialization-order)
    *   [Parameters](#parameters-20)
*   [deserializeTransfer](#deserializetransfer)
    *   [Parameters](#parameters-21)
*   [deserializeTransferWithMemo](#deserializetransferwithmemo)
    *   [Parameters](#parameters-22)
*   [getTransactionType](#gettransactiontype)
    *   [Parameters](#parameters-23)
*   [deserializeTransaction](#deserializetransaction)
    *   [Parameters](#parameters-24)
*   [serializeTransaction](#serializetransaction)
    *   [Parameters](#parameters-25)
*   [IdOwnershipProofs](#idownershipproofs)
*   [CredentialDeploymentTransaction](#credentialdeploymenttransaction)
*   [Address](#address-1)
*   [VerifyAddressResponse](#verifyaddressresponse)
*   [SchemeId](#schemeid)
*   [TransactionType](#transactiontype)
*   [TransferPayload](#transferpayload)
    *   [toAddress](#toaddress)
    *   [amount](#amount)
*   [TransferWithMemoPayload](#transferwithmemopayload)
    *   [toAddress](#toaddress-1)
    *   [amount](#amount-1)
    *   [memo](#memo)
*   [TransactionPayload](#transactionpayload)
*   [sender](#sender)
*   [nonce](#nonce)
*   [expiry](#expiry)
*   [energyAmount](#energyamount)
*   [Transaction](#transaction)
    *   [type](#type)
    *   [payload](#payload)
*   [SigningResult](#signingresult)
*   [pathToBuffer](#pathtobuffer)
    *   [Parameters](#parameters-26)
*   [chunkBuffer](#chunkbuffer)
    *   [Parameters](#parameters-27)

### AccountAddress

Concordium account address with Base58 ↔ Buffer conversion.

Handles Concordium-specific Base58Check encoding:

*   Version byte: 1 (prepended before Base58 encoding)
*   Raw address: 32 bytes
*   Base58 encoded: exactly 50 characters

This class provides a type-safe wrapper for Concordium addresses,
ensuring correct encoding/decoding and validation.

#### Parameters

*   `` &#x20;
*   `buffer`  Raw 32-byte address

#### address

Base58-encoded address string (50 characters)

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### toBase58

Convert address to Base58-encoded string.

##### Examples

```javascript
const base58 = addr.toBase58();
// "3kBx2h5Y2veb4hZgAJWPrr8RyQESKm5TjzF3ti1QQ4VSYLwK1G"
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Base58-encoded address (50 characters)

#### toBuffer

Get raw 32-byte address buffer.

##### Examples

```javascript
const raw = addr.toBuffer();
// Buffer of 32 bytes
```

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Raw address bytes (32 bytes)

#### fromBase58

Parse a Base58-encoded Concordium address.

##### Parameters

*   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Base58 address string (must be exactly 50 characters)

##### Examples

```javascript
const addr = AccountAddress.fromBase58("3kBx2h5Y2veb4hZgAJWPrr8RyQESKm5TjzF3ti1QQ4VSYLwK1G");
```

*   Throws **any** Error if address is not 50 characters or has invalid version byte

Returns **[AccountAddress](#accountaddress)** AccountAddress instance

#### fromBuffer

Create an AccountAddress from raw 32-byte buffer.

##### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** Raw address bytes (must be exactly 32 bytes)

##### Examples

```javascript
const addr = AccountAddress.fromBuffer(Buffer.from("...", "hex"));
```

*   Throws **any** Error if buffer is not 32 bytes

Returns **[AccountAddress](#accountaddress)** AccountAddress instance

### MAX\_MEMO\_LENGTH

Maximum memo length in bytes (UTF-8 encoded) before CBOR encoding.
The device firmware enforces a 256-byte limit on CBOR-encoded data.
CBOR text string encoding adds 2 bytes overhead for lengths 24-254,
so the maximum UTF-8 text is 254 bytes.

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

### MAX\_CBOR\_SIZE

Maximum CBOR-encoded memo size (including CBOR overhead).
This is the device firmware limit.

Type: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)

### encodeMemoToCbor

Encodes a memo string to CBOR text string format.

Concordium memos must be CBOR-encoded before transmission to the device.
The device expects CBOR text strings and will decode them for display.

CBOR text string encoding (major type 3):

*   0x60-0x77: lengths 0-23 (direct encoding, 1 byte overhead)
*   0x78 + length byte: lengths 24-254 (2 bytes overhead)
*   0x79 + 2 length bytes: lengths 255-65535 (3 bytes overhead, not supported for memos)

#### Parameters

*   `memo` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The memo string to encode (max 254 bytes UTF-8)

<!---->

*   Throws **any** Error if memo exceeds 254 bytes UTF-8

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Buffer containing CBOR-encoded text string

### decodeMemoFromCbor

Decodes a CBOR-encoded memo string.

The wallet-proxy and device return memos in CBOR-encoded format.
This function decodes them back to plain UTF-8 strings for display.

Supports CBOR text string decoding:

*   0x60-0x77: lengths 0-23
*   0x78 + 1 byte: lengths 24-255
*   0x79 + 2 bytes: lengths 256-65535

Note: While we only encode up to 254 bytes, we support decoding larger memos
that may come from wallet-proxy or other sources.

If you have a hex or base64 encoded string, convert it to Buffer first:

*   From hex: `Buffer.from(hexString, "hex")`
*   From base64: `Buffer.from(base64String, "base64")`

#### Parameters

*   `cborEncoded` **[Buffer](https://nodejs.org/api/buffer.html)** CBOR-encoded memo as Buffer

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Decoded UTF-8 string

### Concordium

Concordium Hardware Wallet API

Provides low-level device communication for Concordium blockchain operations.
All transaction types use hw-app-specific formats (raw Buffers, no SDK dependencies).

#### Parameters

*   `transport` **Transport** Transport for sending commands to a device
*   `scrambleKey`  App-specific key used to scramble APDU data exchanges (optional, default `"concordium_default_scramble_key"`)

#### getAddress

Get Concordium address for a given path.

##### Parameters

*   `originalPath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path
*   `display` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether to display/verify address on device (default: false) (optional, default `false`)
*   `id` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity number
*   `cred` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Credential number
*   `idp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity provider number

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Address](#address)>** Promise with address and publicKey

#### verifyAddress

Verify address on device.

##### Parameters

*   `id` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity number
*   `cred` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Credential number
*   `idp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity provider number
*   `credentialId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Credential ID (hex) to compute on-chain address

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[VerifyAddressResponse](#verifyaddressresponse)>** Promise with status, address, deviceCredId, and devicePrfKey

#### getPublicKey

Get public key for a given path.

##### Parameters

*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path
*   `confirm`  Require user confirmation on device (default: false) (optional, default `false`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Promise with public key (hex string)

#### signTransaction

Sign a transaction (Transfer or TransferWithMemo).
Routes to the appropriate signing method based on transaction type.

##### Parameters

*   `tx` **[Transaction](#transaction)** Transaction to sign
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[SigningResult](#signingresult)>** Promise with signature and serialized transaction

#### signCredentialDeployment

Sign a credential deployment transaction.

Always creates credentials for new accounts on existing identities.
The device displays the expiry time for user verification.

##### Parameters

*   `tx` **[CredentialDeploymentTransaction](#credentialdeploymenttransaction)** CredentialDeploymentTransaction in hw-app format
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Promise with signature (hex string)

### serializeTransfer

Serializes a Transfer transaction (simple transfer without memo).

Output format: \[sender:32]\[nonce:8]\[energyAmount:8]\[payloadSize:4]\[expiry:8]\[type:1]\[recipient:32]\[amount:8]

#### Parameters

*   `tx` **[Transaction](#transaction)** Transfer transaction

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized transaction ready for network submission

### prepareTransferAPDU

Prepares Transfer APDU payloads for device signing.

Transfer uses standard APDU sequence with chunking (255 bytes per chunk).
Path is prepended ONLY to the first chunk.

#### Parameters

*   `serialized` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized Transfer transaction
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>** APDU payloads ready for device transmission (chunked)

### serializeTransferWithMemo

Serializes a TransferWithMemo transaction (transfer with memo).

Output format: \[sender:32]\[nonce:8]\[energyAmount:8]\[payloadSize:4]\[expiry:8]\[type:1]\[recipient:32]\[memo\_length:2]\[memo:N]\[amount:8]

#### Parameters

*   `tx` **[Transaction](#transaction)** TransferWithMemo transaction

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized transaction ready for network submission

### prepareTransferWithMemoAPDU

Prepares TransferWithMemo APDU payloads for device signing.

TransferWithMemo requires a special 3-step APDU sequence:

1.  Header + recipient + memo length
2.  Memo chunks (255 bytes each)
3.  Amount

#### Parameters

*   `serialized` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized TransferWithMemo transaction
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **{headerPayload: [Buffer](https://nodejs.org/api/buffer.html), memoPayloads: [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>, amountPayload: [Buffer](https://nodejs.org/api/buffer.html)}** Object with headerPayload, memoPayloads array, and amountPayload

### serializeTransactionPayloads

Chunks raw data into APDU-sized payloads without derivation path.

Used for credential deployment attribute values and proofs which don't need path prefix.
Splits data into MAX\_CHUNK\_SIZE (255 byte) chunks for APDU transmission.

#### Parameters

*   `rawTx` **[Buffer](https://nodejs.org/api/buffer.html)** Raw data to chunk

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>** Array of payload buffers ready for sequential APDU transmission

### serializeCredentialDeployment

Serializes a credential deployment transaction for hardware wallet signing.

Takes hw-app format transaction and prepares it for transmission to device
by chunking it into appropriate APDU payloads.

Always creates credentials for new accounts on existing identities (Ledger Live use case).
The device receives the expiry time to display for user verification.

#### Parameters

*   `tx` **[CredentialDeploymentTransaction](#credentialdeploymenttransaction)** Credential deployment transaction in hw-app format
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 derivation path

Returns **any** Structured payload components ready for APDU transmission

### serializeIdOwnershipProofsPrefix

Serializes the common prefix of ID ownership proofs up to and including proofRegId.

This helper extracts the shared serialization logic used by both `serializeIdOwnershipProofs`
and `insertAccountOwnershipProofs` to ensure they stay in sync.

Serialization order:

1.  sig (IP signature)
2.  commitments
3.  challenge
4.  proofIdCredPub (u32 count + map entries with u32 keys, sorted by index)
5.  proofIpSig (identity provider signature proof)
6.  proofRegId (registration ID proof)

#### Parameters

*   `proofs` **[IdOwnershipProofs](#idownershipproofs)** ID ownership proofs from Concordium ID App

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized prefix buffer (everything up to and including proofRegId)

### serializeIdOwnershipProofs

*   **See**: insertAccountOwnershipProofs for combining ID and account proofs

Serializes ID ownership proofs for credential deployment.

This function serializes the identity ownership proofs received from the Concordium ID App
into the binary format required for credential deployment transactions. It handles the
ID ownership portion only - account ownership proofs must be inserted separately using
`insertAccountOwnershipProofs()`.

Used as part of the credential deployment flow:

1.  Get ID ownership proofs from Concordium ID App
2.  Serialize them with this function
3.  Sign with device using `signCredentialDeployment()`
4.  Insert account ownership proofs using `insertAccountOwnershipProofs()`
5.  Submit complete credential deployment to blockchain

#### Parameters

*   `proofs` **[IdOwnershipProofs](#idownershipproofs)** ID ownership proofs from Concordium ID App

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized ID ownership proofs as Buffer

### serializeAccountOwnershipProofs

Serializes account ownership proofs from Ed25519 signatures.

Structure (matching Concordium node expectations):

*   Number of signatures (1 byte, u8)
*   For each signature:
    *   Key index (1 byte, u8)
    *   Signature (64 bytes for Ed25519)

#### Parameters

*   `signatures` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Array of Ed25519 signatures as hex strings

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized account ownership proofs as Buffer

### insertAccountOwnershipProofs

Inserts account ownership proofs into ID ownership proofs to build complete CredDeploymentProofs.

This function is critical for credential deployment. It takes the ID ownership proofs
from the Concordium ID App and the account ownership signature from the Ledger device,
then combines them into the complete proof structure required by the Concordium blockchain.

### Why Insertion Order Matters

The Concordium protocol defines a specific serialization order for CredDeploymentProofs.
The account ownership proofs MUST be inserted at position 7 (between proofRegId and credCounterLessThanMaxAccounts),
not appended at the end.

Incorrect ordering will cause the blockchain node to reject the credential with the error:
"Credential rejected by the node"

### Serialization Order

1.  sig (IP signature)
2.  commitments
3.  challenge
4.  proofIdCredPub (u32 count + map entries with u32 keys, sorted by index)
5.  proofIpSig (identity provider signature proof)
6.  proofRegId (registration ID proof)
7.  **proof\_acc\_sk (AccountOwnershipProof) ← INSERTED HERE**
8.  credCounterLessThanMaxAccounts

#### Parameters

*   `idProofs` **[IdOwnershipProofs](#idownershipproofs)** ID ownership proofs from the Concordium ID App
*   `accountSignature` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Account ownership signature from the Ledger device (hex string, 64 bytes)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Complete CredDeploymentProofs as hex string, ready for submission

### deserializeTransfer

Deserializes a Transfer transaction from serialized buffer.

Parses the binary format and reconstructs the structured Transaction object.
Expected format: \[sender:32]\[nonce:8]\[energyAmount:8]\[payloadSize:4]\[expiry:8]\[type:1]\[recipient:32]\[amount:8]

#### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized Transfer transaction

Returns **[Transaction](#transaction)** Structured Transaction with all fields populated

### deserializeTransferWithMemo

Deserializes a TransferWithMemo transaction from serialized buffer.

Parses the binary format and reconstructs the structured Transaction object with memo.
Expected format: \[sender:32]\[nonce:8]\[energyAmount:8]\[payloadSize:4]\[expiry:8]\[type:1]\[recipient:32]\[memo\_length:2]\[memo:N]\[amount:8]

#### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized TransferWithMemo transaction

Returns **[Transaction](#transaction)** Structured Transaction with all fields including memo

### getTransactionType

Gets the transaction type from a serialized transaction buffer.

Common header format: \[sender:32]\[nonce:8]\[energyAmount:8]\[payloadSize:4]\[expiry:8]\[type:1]
The type byte is at offset 60 (32+8+8+4+8).

Payload structure varies by type:

*   Transfer (0x03): \[recipient:32]\[amount:8]
*   TransferWithMemo (0x16): \[recipient:32]\[memo\_length:2]\[memo:N]\[amount:8]

#### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized transaction buffer

<!---->

*   Throws **any** Error if buffer is too short or type is invalid

Returns **[TransactionType](#transactiontype)** The transaction type

### deserializeTransaction

Deserializes a transaction buffer by automatically detecting its type.

#### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized transaction buffer

<!---->

*   Throws **any** Error if buffer is invalid or type is unsupported

Returns **[Transaction](#transaction)** The deserialized transaction

### serializeTransaction

Serializes a transaction by automatically using the correct serializer based on its type.

#### Parameters

*   `transaction` **[Transaction](#transaction)** The transaction to serialize

<!---->

*   Throws **any** Error if transaction type is unsupported

Returns **[Buffer](https://nodejs.org/api/buffer.html)** The serialized transaction buffer

### IdOwnershipProofs

ID ownership proofs from ID App.
Must be serialized when building the message hash for device signing.

### CredentialDeploymentTransaction

Credential deployment transaction format expected by Ledger device.

This is the hw-app format, not the SDK CredentialDeploymentTransaction type.
Use coin-concordium/hw-serialization to transform SDK → hw-app format.

### Address

Address response from device

### VerifyAddressResponse

Verify address response from device

### SchemeId

Cryptographic signature scheme identifier

### TransactionType

Transaction type enum.
Values match Concordium protocol transaction type discriminators.

### TransferPayload

Transfer transaction payload (simple transfer without memo).

Used for basic CCD transfers between accounts.

#### toAddress

Recipient's Concordium address

Type: AccountAddressType

#### amount

Transfer amount in microCCD (1 CCD = 1,000,000 microCCD)

Type: bigint

### TransferWithMemoPayload

Transfer with memo transaction payload.

Used for CCD transfers that include a message/memo.
The memo must be CBOR-encoded using encodeMemoToCbor() before inclusion.

#### toAddress

Recipient's Concordium address

Type: AccountAddressType

#### amount

Transfer amount in microCCD (1 CCD = 1,000,000 microCCD)

Type: bigint

#### memo

CBOR-encoded memo (use encodeMemoToCbor to encode UTF-8 string)

Type: [Buffer](https://nodejs.org/api/buffer.html)

### TransactionPayload

Union type of all supported transaction payloads.

Type: ([TransferPayload](#transferpayload) | [TransferWithMemoPayload](#transferwithmemopayload))

### sender

Sender's Concordium address

Type: AccountAddressType

### nonce

Account nonce / sequence number

Type: bigint

### expiry

Transaction expiry time (epoch seconds)

Type: bigint

### energyAmount

Maximum energy (gas) for transaction execution

Type: bigint

### Transaction

Transaction

This is the hw-app format that owns transaction structure definition.
Used by signTransfer() and signTransferWithMemo() methods.

The type field determines which payload structure is expected:

*   TransactionType.Transfer → TransferPayload
*   TransactionType.TransferWithMemo → TransferWithMemoPayload

#### type

Transaction type discriminator

Type: [TransactionType](#transactiontype)

#### payload

Type-safe payload (structure depends on type field)

Type: [TransactionPayload](#transactionpayload)

### SigningResult

Signing result with both signature and serialized transaction.

### pathToBuffer

Converts a BIP32 path string to serialized Buffer format.

#### Parameters

*   `originalPath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path string (e.g., "44'/919'/0'/0/0")

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized path buffer ready for device transmission

### chunkBuffer

Chunks a buffer into smaller pieces of a maximum size.

#### Parameters

*   `buffer` **[Buffer](https://nodejs.org/api/buffer.html)** The buffer to chunk
*   `maxSize` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Maximum size of each chunk

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>** Array of buffer chunks

## Usage

### Basic Setup

```javascript
import Concordium from "@ledgerhq/hw-app-concordium";
import TransportWebHID from "@ledgerhq/hw-transport-webhid";

const transport = await TransportWebHID.create();
const ccd = new Concordium(transport);
```

### getAddress

Get a Concordium address for a given BIP32 path.

```javascript
// Without display (returns public key as address during scanning)
const { address, publicKey } = await ccd.getAddress(
  "m/44'/919'/0'/0/0",
  false, // display
  0,     // identity
  0,     // credential
  0,     // identity provider
);

// With display (user verification on device)
const { address, publicKey } = await ccd.getAddress(
  "m/44'/919'/0'/0/0",
  true,  // display
  0,     // identity
  0,     // credential
  0,     // identity provider
);
```

### verifyAddress

Verify an address on the device screen.

```javascript
// Basic verification
const { status, address } = await ccd.verifyAddress(
  0,           // identity
  0,           // credential
  0,           // identity provider
);

// Verification with credential ID (compute on-chain address)
const { status, address, deviceCredId, devicePrfKey } = await ccd.verifyAddress(
  0,           // identity
  0,           // credential
  0,           // identity provider
  "a5119f..."  // credential ID (hex)
);
```

### getPublicKey

Get a public key for a given path.

```javascript
// Without confirmation
const publicKey = await ccd.getPublicKey("m/44'/919'/0'/0/0");

// With user confirmation on device
const publicKey = await ccd.getPublicKey("m/44'/919'/0'/0/0", true);
```

### signTransfer

Sign a Transfer transaction (simple transfer without memo).

**Note:** This method expects hw-app format with structured Transaction type. If you're using the Concordium SDK, use `@ledgerhq/coin-concordium` which handles the transformation.

```javascript
import { TransactionType, AccountAddress } from "@ledgerhq/hw-app-concordium/lib/types";

// Example Transfer transaction
const tx = {
  type: TransactionType.Transfer,
  header: {
    sender: AccountAddress.fromBase58("3kBx2h5Y2veb4hZgAJWPrr8RyQESKm5TjzF3ti1QQ4VSYLwK1G"),
    nonce: 5n,
    expiry: 1745517351n,
    energyAmount: 100000n,
  },
  payload: {
    toAddress: AccountAddress.fromBase58("48x2Uo8xCMMxwGuSQnwbqjzKtVqK5MaUud4vG7QEUgDmYkV85e"),
    amount: 1000000n,  // 1 CCD in microCCD
  },
};

const { signature, serialized } = await ccd.signTransfer(tx, "m/44'/919'/0'/0/0");
// signature: hex string for signing
// serialized: hex string ready for network submission
```

### signTransferWithMemo

Sign a TransferWithMemo transaction (transfer with memo).

```javascript
import { TransactionType, AccountAddress } from "@ledgerhq/hw-app-concordium/lib/types";
import { encodeMemoToCbor } from "@ledgerhq/hw-app-concordium/lib/cbor";

// Example TransferWithMemo transaction
const tx = {
  type: TransactionType.TransferWithMemo,
  header: {
    sender: AccountAddress.fromBase58("3kBx2h5Y2veb4hZgAJWPrr8RyQESKm5TjzF3ti1QQ4VSYLwK1G"),
    nonce: 5n,
    expiry: 1745517351n,
    energyAmount: 150000n,
  },
  payload: {
    toAddress: AccountAddress.fromBase58("48x2Uo8xCMMxwGuSQnwbqjzKtVqK5MaUud4vG7QEUgDmYkV85e"),
    amount: 1000000n,
    memo: encodeMemoToCbor("Payment for services"),
  },
};

const { signature, serialized } = await ccd.signTransferWithMemo(tx, "m/44'/919'/0'/0/0");
```

### signCredentialDeployment

Sign a credential deployment transaction.

**Note:** This method expects hw-app format. Use `@ledgerhq/coin-concordium` for SDK type handling.

```javascript
import type { CredentialDeploymentTransaction } from "@ledgerhq/hw-app-concordium/lib/types";

const tx: CredentialDeploymentTransaction = {
  credentialPublicKeys: {
    keys: {
      0: { schemeId: "Ed25519", verifyKey: "a1b2c3..." }
    },
    threshold: 1
  },
  credId: "def456...",  // hex string
  ipIdentity: 0,
  revocationThreshold: 1,
  arData: {
    "1": { encIdCredPubShare: "abc123..." }
  },
  policy: {
    validTo: "202512",
    createdAt: "202501",
    revealedAttributes: {}
  },
  proofs: "fedcba...",  // hex string (pre-serialized)
  expiry: 1745517351n
};

const signature = await ccd.signCredentialDeployment(
  tx,
  "m/44'/919'/0'/0/0",
  {
    isNew: true,
    address: Buffer.from("...")  // 32 bytes if existing account
  }
);
```

## Types

This package exports hw-app-specific types:

```typescript
import {
  TransactionType,
  AccountAddress,
  type Transaction,
  type TransferPayload,
  type TransferWithMemoPayload,
  type CredentialDeploymentTransaction,
  type IdOwnershipProofs,
  type Address,
  type VerifyAddressResponse,
  type SigningResult,
} from "@ledgerhq/hw-app-concordium/lib/types";
```

### Transaction Type Enum

```typescript
enum TransactionType {
  Transfer = 3,              // Simple transfer without memo
  TransferWithMemo = 22,     // Transfer with memo
}
```

### Transaction Structure

```typescript
// Transfer transaction structure
interface Transaction {
  type: TransactionType.Transfer;
  header: {
    sender: AccountAddress;      // Sender's address
    nonce: bigint;              // Account nonce / sequence number
    expiry: bigint;             // Transaction expiry (epoch seconds)
    energyAmount: bigint;       // Maximum energy for transaction
  };
  payload: {
    toAddress: AccountAddress;   // Recipient's address
    amount: bigint;             // Amount in microCCD (1 CCD = 1,000,000 microCCD)
  };
}

// TransferWithMemo transaction structure
interface Transaction {
  type: TransactionType.TransferWithMemo;
  header: {
    sender: AccountAddress;
    nonce: bigint;
    expiry: bigint;
    energyAmount: bigint;
  };
  payload: {
    toAddress: AccountAddress;
    amount: bigint;
    memo: Buffer;               // CBOR-encoded memo (use encodeMemoToCbor)
  };
}
```

### Type Characteristics

**hw-app types use:**

*   `AccountAddress` class for addresses (handles Base58 ↔ Buffer conversion)
*   Primitive `bigint` for numeric fields (nonce, expiry, energyAmount, amount)
*   Structured payloads with type safety (`TransferPayload`, `TransferWithMemoPayload`)
*   CBOR-encoded `Buffer` for memos (use `encodeMemoToCbor` utility)
*   `IdOwnershipProofs` object for credential proofs (hw-app serializes this)

**For SDK integration**, use `@ledgerhq/coin-concordium` which provides transformation between SDK and hw-app formats.

## Utilities

The package exports serialization utilities from `@ledgerhq/hw-app-concordium/lib/serialization`:

*   `serializeTransfer(tx)` - Serialize Transfer transaction to Buffer
*   `serializeTransferWithMemo(tx)` - Serialize TransferWithMemo transaction to Buffer
*   `deserializeTransfer(buffer)` - Deserialize Transfer transaction from Buffer
*   `deserializeTransferWithMemo(buffer)` - Deserialize TransferWithMemo transaction from Buffer
*   `serializeCredentialDeployment(tx, path)` - Serialize credential deployment for device
*   `serializeAccountOwnershipProofs(signatures)` - Serialize account ownership proofs
*   `insertAccountOwnershipProofs(idProofs, accountSignature)` - Combine ID and account proofs
*   `prepareTransferAPDU(serialized, path)` - Prepare Transfer APDU payloads
*   `prepareTransferWithMemoAPDU(serialized, path)` - Prepare TransferWithMemo APDU payloads
*   `serializeTransactionPayloads(rawTx)` - Chunk data into APDU payloads

CBOR utilities from `@ledgerhq/hw-app-concordium/lib/cbor`:

*   `encodeMemoToCbor(memo)` - Encode UTF-8 string to CBOR text string
*   `decodeMemoFromCbor(cborEncoded)` - Decode CBOR text string to UTF-8
*   `MAX_MEMO_LENGTH` - Maximum memo length constant (254 bytes)
*   `MAX_CBOR_SIZE` - Maximum CBOR encoded size constant (256 bytes)

Address utilities from `@ledgerhq/hw-app-concordium/lib/address`:

*   `AccountAddress.fromBase58(address)` - Parse Base58 address
*   `AccountAddress.toBase58()` - Convert to Base58 string
*   `AccountAddress.toBuffer()` - Get raw 32-byte address

Encoding utilities from `@ledgerhq/hw-app-concordium/lib/utils`:

*   `encodeWord8(value)`, `encodeWord16(value)`, `encodeWord32(value)`, `encodeWord64(value)` - Encode integers
*   `decodeWord16(buffer, offset)`, `decodeWord32(buffer, offset)`, `decodeWord64(buffer, offset)` - Decode integers
*   `serializeMap(map, encodeSize, encodeKey, encodeValue)` - Serialize map/object
*   `serializeVerifyKey(key)` - Serialize verification key
*   `serializeYearMonth(yearMonth)` - Serialize year-month string (YYYYMM)
*   `pathToBuffer(path)` - Convert BIP32 path string to Buffer
*   `chunkBuffer(buffer, maxSize)` - Chunk buffer into smaller pieces

## License

This project is licensed under the Apache-2.0 License - see the [LICENSE](LICENSE) file for details.
