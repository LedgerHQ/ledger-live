<img src="https://user-images.githubusercontent.com/4631227/191834116-59cf590e-25cc-4956-ae5c-812ea464f324.png" height="100" />

[GitHub](https://github.com/LedgerHQ/ledger-live/),
[Ledger Devs Discord](https://developers.ledger.com/discord-pro),
[Developer Portal](https://developers.ledger.com/)

## @ledgerhq/hw-app-concordium

Ledger Hardware Wallet Concordium JavaScript bindings.

**Low-level device communication library with no blockchain SDK dependencies (requires `@ledgerhq/hw-transport` and `bip32-path`).**

This package provides direct communication with Concordium Ledger device apps. It uses hw-app-specific types (raw Buffers, primitives) independent of the Concordium SDK.

For Ledger Live integration, use `@ledgerhq/coin-concordium` which handles SDK type transformations.

***

## Are you adding Ledger support to your software wallet?

You may be using this package to communicate with the Concordium Nano App.

For a smooth and quick integration:

*   See the developers' documentation on the [Developer Portal](https://developers.ledger.com/docs/transport/overview/) and
*   Go on [Discord](https://developers.ledger.com/discord-pro/) to chat with developer support and the developer community.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

*   [Concordium](#concordium)
    *   [Parameters](#parameters)
    *   [getAddress](#getaddress)
        *   [Parameters](#parameters-1)
    *   [verifyAddress](#verifyaddress)
        *   [Parameters](#parameters-2)
    *   [getPublicKey](#getpublickey)
        *   [Parameters](#parameters-3)
    *   [signTransfer](#signtransfer)
        *   [Parameters](#parameters-4)
    *   [signCredentialDeployment](#signcredentialdeployment)
        *   [Parameters](#parameters-5)
*   [splitPath](#splitpath)
    *   [Parameters](#parameters-6)
*   [pathToBuffer](#pathtobuffer)
    *   [Parameters](#parameters-7)
*   [serializeTransactionPayloadsWithDerivationPath](#serializetransactionpayloadswithderivationpath)
    *   [Parameters](#parameters-8)
*   [serializeTransactionPayloads](#serializetransactionpayloads)
    *   [Parameters](#parameters-9)
*   [serializeTransaction](#serializetransaction)
    *   [Parameters](#parameters-10)
*   [serializeTransferWithMemo](#serializetransferwithmemo)
    *   [Parameters](#parameters-11)
*   [serializeCredentialDeployment](#serializecredentialdeployment)
    *   [Parameters](#parameters-12)
*   [CredentialDeploymentTransaction](#credentialdeploymenttransaction)
*   [AccountTransaction](#accounttransaction)
*   [Address](#address)
*   [VerifyAddressResponse](#verifyaddressresponse)
*   [SignCredentialDeploymentMetadata](#signcredentialdeploymentmetadata)

### Concordium

Concordium Hardware Wallet API

Provides low-level device communication for Concordium blockchain operations.
All transaction types use hw-app-specific formats (raw Buffers, no SDK dependencies).

#### Parameters

*   `transport` **Transport** Transport for sending commands to a device
*   `scrambleKey`  App-specific key used to scramble APDU data exchanges (optional, default `"concordium_default_scramble_key"`)

#### getAddress

Get Concordium address for a given path.

##### Parameters

*   `originalPath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path
*   `display` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether to display/verify address on device (default: true) (optional, default `true`)
*   `id` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity number
*   `cred` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Credential number
*   `idp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity provider number

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[Address](#address)>** Promise with address and publicKey

#### verifyAddress

Verify address on device.

##### Parameters

*   `id` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity number
*   `cred` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Credential number
*   `idp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Identity provider number
*   `credentialId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Credential ID (hex) to compute on-chain address

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[VerifyAddressResponse](#verifyaddressresponse)>** Promise with status, address, deviceCredId, and devicePrfKey

#### getPublicKey

Get public key for a given path.

##### Parameters

*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path
*   `confirm`  Require user confirmation on device (default: false) (optional, default `false`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Promise with public key (hex string)

#### signTransfer

Sign an account transaction.

##### Parameters

*   `txn` **[AccountTransaction](#accounttransaction)** Account transaction in hw-app format (sender as Buffer, payload pre-serialized)
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Promise with signature (hex string)

#### signCredentialDeployment

Sign a credential deployment transaction.

##### Parameters

*   `payload` **[CredentialDeploymentTransaction](#credentialdeploymenttransaction)** CredentialDeploymentTransaction in hw-app format
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key
*   `metadata` **[SignCredentialDeploymentMetadata](#signcredentialdeploymentmetadata)?** Optional metadata for hardware wallet (isNew, address as Buffer)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)<[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Promise with signature (hex string)

### splitPath

Splits a BIP32 path string into numeric components.

Handles hardened derivation (apostrophe suffix) by adding 0x80000000.
Example: "m/44'/919'/0'/0/0" → \[0x8000002C, 0x80000397, 0x80000000, 0, 0]

#### Parameters

*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path string (e.g., "m/44'/919'/0'/0/0")

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** Array of path components as numbers

### pathToBuffer

Converts a BIP32 path string to serialized Buffer format.

#### Parameters

*   `originalPath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path string (e.g., "44'/919'/0'/0/0")

Returns **[Buffer](https://nodejs.org/api/buffer.html)** Serialized path buffer ready for device transmission

### serializeTransactionPayloadsWithDerivationPath

Chunks transaction data into APDU-sized payloads with derivation path in first chunk.

Splits large transactions into MAX\_CHUNK\_SIZE (255 byte) chunks for APDU transmission.
The first chunk includes the serialized derivation path, subsequent chunks contain only data.

#### Parameters

*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 derivation path string
*   `rawTx` **[Buffer](https://nodejs.org/api/buffer.html)** Serialized transaction data

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>** Array of payload buffers ready for sequential APDU transmission

### serializeTransactionPayloads

Chunks raw data into APDU-sized payloads without derivation path.

Used for credential deployment attribute values and proofs which don't need path prefix.
Splits data into MAX\_CHUNK\_SIZE (255 byte) chunks for APDU transmission.

#### Parameters

*   `rawTx` **[Buffer](https://nodejs.org/api/buffer.html)** Raw data to chunk

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>** Array of payload buffers ready for sequential APDU transmission

### serializeTransaction

Serializes a transaction for hardware wallet signing.

#### Parameters

*   `txn` **[AccountTransaction](#accounttransaction)** Account transaction with all fields prepared
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 derivation path

Returns **{payloads: [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>}** Object with payloads ready for APDU transmission

### serializeTransferWithMemo

Serializes a TransferWithMemo transaction for hardware wallet signing.

Expects hw-app format where payload is pre-serialized Buffer containing:

*   32 bytes: recipient address
*   2 bytes: memo length (u16 big-endian)
*   N bytes: memo data
*   8 bytes: amount (u64 big-endian)

#### Parameters

*   `txn` **[AccountTransaction](#accounttransaction)** Account transaction in hw-app format with pre-serialized payload
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 path for signing key

Returns **{headerPayload: [Buffer](https://nodejs.org/api/buffer.html), memoPayloads: [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)<[Buffer](https://nodejs.org/api/buffer.html)>, amountPayload: [Buffer](https://nodejs.org/api/buffer.html)}** Object with header, memo chunks, and amount payloads for APDU transmission

### serializeCredentialDeployment

Serializes a credential deployment transaction for hardware wallet signing.

Takes hw-app format transaction and prepares it for transmission to device
by chunking it into appropriate APDU payloads.

#### Parameters

*   `payload` **[CredentialDeploymentTransaction](#credentialdeploymenttransaction)** Credential deployment transaction in hw-app format
*   `path` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** BIP32 derivation path
*   `metadata` **{isNew: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, address: [Buffer](https://nodejs.org/api/buffer.html)?}?** Optional metadata (isNew flag, existing account address as Buffer)

Returns **any** Structured payload components ready for APDU transmission

### CredentialDeploymentTransaction

Credential deployment transaction format expected by Ledger device.

This is the hw-app format, not the SDK CredentialDeploymentTransaction type.
Use coin-concordium/hw-serialization to transform SDK → hw-app format.

### AccountTransaction

Account transaction format expected by Ledger device.

This is the hw-app format, not the SDK AccountTransaction type.
Use coin-concordium/hw-serialization to transform SDK → hw-app format.

### Address

Address response from device

### VerifyAddressResponse

Verify address response from device

### SignCredentialDeploymentMetadata

Metadata for credential deployment signing

## Usage

### Basic Setup

```javascript
import Concordium from "@ledgerhq/hw-app-concordium";
import TransportWebHID from "@ledgerhq/hw-transport-webhid";

const transport = await TransportWebHID.create();
const ccd = new Concordium(transport);
```

### getAddress

Get a Concordium address for a given BIP32 path.

```javascript
// Without display (returns public key as address during scanning)
const { address, publicKey } = await ccd.getAddress(
  "m/44'/919'/0'/0/0",
  false, // display
  0,     // identity
  0,     // credential
  0,     // identity provider
);

// With display (user verification on device)
const { address, publicKey } = await ccd.getAddress(
  "m/44'/919'/0'/0/0",
  true,  // display
  0,     // identity
  0,     // credential
  0,     // identity provider
);
```

### verifyAddress

Verify an address on the device screen.

```javascript
// Basic verification
const { status, address } = await ccd.verifyAddress(
  0,           // identity
  0,           // credential
  0,           // identity provider
);

// Verification with credential ID (compute on-chain address)
const { status, address, deviceCredId, devicePrfKey } = await ccd.verifyAddress(
  0,           // identity
  0,           // credential
  0,           // identity provider
  "a5119f..."  // credential ID (hex)
);
```

### getPublicKey

Get a public key for a given path.

```javascript
// Without confirmation
const publicKey = await ccd.getPublicKey("m/44'/919'/0'/0/0");

// With user confirmation on device
const publicKey = await ccd.getPublicKey("m/44'/919'/0'/0/0", true);
```

### signTransfer

Sign an account transaction.

**Note:** This method expects hw-app format (raw Buffers, not SDK types). If you're using the Concordium SDK, use `@ledgerhq/coin-concordium` which handles the transformation.

```javascript
import type { AccountTransaction } from "@ledgerhq/hw-app-concordium/lib/types";

// Example hw-app format transaction
const tx: AccountTransaction = {
  sender: Buffer.from("..."),  // 32 bytes raw address
  nonce: 5n,
  expiry: 1745517351n,
  energyAmount: 100000n,
  transactionType: 3,  // Transfer
  payload: Buffer.from("...")  // Pre-serialized payload
};

const signature = await ccd.signTransfer(tx, "m/44'/919'/0'/0/0");
```

### signCredentialDeployment

Sign a credential deployment transaction.

**Note:** This method expects hw-app format. Use `@ledgerhq/coin-concordium` for SDK type handling.

```javascript
import type { CredentialDeploymentTransaction } from "@ledgerhq/hw-app-concordium/lib/types";

const tx: CredentialDeploymentTransaction = {
  credentialPublicKeys: {
    keys: {
      0: { schemeId: "Ed25519", verifyKey: "a1b2c3..." }
    },
    threshold: 1
  },
  credId: "def456...",  // hex string
  ipIdentity: 0,
  revocationThreshold: 1,
  arData: {
    "1": { encIdCredPubShare: "abc123..." }
  },
  policy: {
    validTo: "202512",
    createdAt: "202501",
    revealedAttributes: {}
  },
  proofs: "fedcba...",  // hex string (pre-serialized)
  expiry: 1745517351n
};

const signature = await ccd.signCredentialDeployment(
  tx,
  "m/44'/919'/0'/0/0",
  {
    isNew: true,
    address: Buffer.from("...")  // 32 bytes if existing account
  }
);
```

## Types

This package exports hw-app-specific types:

```typescript
import type {
  AccountTransaction,
  CredentialDeploymentTransaction,
  Address,
  VerifyAddressResponse,
} from "@ledgerhq/hw-app-concordium/lib/types";
```

### Type Characteristics

**hw-app types use:**

*   Raw `Buffer` for addresses (32 bytes), not Base58 strings
*   Primitive `bigint` for numeric fields, not SDK branded types
*   Hex strings for proofs, not `IdOwnershipProofs` objects
*   Pre-serialized `Buffer` for payloads

**For SDK integration**, use `@ledgerhq/coin-concordium` which provides transformation utilities.

## Utilities

The package exports serialization utilities from `@ledgerhq/hw-app-concordium/lib/serialization`:

*   `serializeTransaction(txn, path)` - Serialize account transaction for signing
*   `serializeCredentialDeployment(payload, path, metadata)` - Serialize credential deployment
*   `splitPath(path)` - Split BIP32 path string into array of numbers
*   `pathToBuffer(path)` - Convert BIP32 path string to Buffer
*   `serializeTransactionPayloads(rawTx)` - Chunk data into APDU payloads
*   `serializeTransactionPayloadsWithDerivationPath(path, rawTx)` - Chunk with path prefix

Encoding utilities from `@ledgerhq/hw-app-concordium/lib/utils`:

*   `encodeWord8(value)`, `encodeWord16(value)`, `encodeWord32(value)`, `encodeWord64(value)` - Encode integers
*   `serializeMap(map, encodeSize, encodeKey, encodeValue)` - Serialize map/object
*   `serializeVerifyKey(key)` - Serialize verification key
*   `serializeYearMonth(yearMonth)` - Serialize year-month string (YYYYMM)
*   `serializeIdOwnershipProofs(proofs)` - Serialize ID ownership proofs to hex string

## License

This project is licensed under the Apache-2.0 License - see the [LICENSE](LICENSE) file for details.
