name: "Generate Timing-Based Shards"
description: "Generates shard-specific test files using timing data for optimization"
inputs:
  test_filter:
    description: "Test name filter (space-separated, optional)"
    required: false
    default: ""
  test_directory:
    description: "Directory containing test files (default: e2e/mobile)"
    required: false
    default: "e2e/mobile"
  platform:
    description: "Platform (ios or android)"
    required: true
  shard_index:
    description: "Current shard index (1-based)"
    required: true
  shard_total:
    description: "Total number of shards"
    required: true
  test_files_for_sharding:
    description: "All test files for sharding"
    required: false
    default: ""

runs:
  using: "composite"
  steps:
    - name: Generate shard-specific test files
      id: shard-files
      shell: bash
      run: |
        SHARD_TEST_FILES=$(node apps/ledger-live-mobile/scripts/shard-tests.mjs "${{ inputs.test_filter || '' }}" ${{ inputs.platform }} ${{ inputs.test_directory }} ${{ inputs.shard_index }} ${{ inputs.shard_total }})
        echo "shard_test_files<<EOF" >> $GITHUB_OUTPUT
        echo "$SHARD_TEST_FILES" >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
        echo "Generated test files for shard ${{ inputs.shard_index }}/${{ inputs.shard_total }}: $SHARD_TEST_FILES"

outputs:
  shard_test_files:
    description: "Test files for specific shard"
    value: ${{ steps.shard-files.outputs.shard_test_files }} 