name: "Setup Android Environment"
description: "Setup common Android development environment (JDK, SDK, hardware acceleration)"
inputs:
  jdk_version:
    description: "JDK version to install"
    required: false
    default: "17"
  jdk_distribution:
    description: "JDK distribution"
    required: false
    default: "zulu"
  android_packages:
    description: "Android SDK packages to install"
    required: false
    default: "tools platform-tools"

runs:
  using: "composite"
  steps:
    - name: Setup JDK ${{ inputs.jdk_version }}
      uses: actions/setup-java@17f84c3641ba7b8f6deff6309fc4c864478f5d62 # v3
      with:
        distribution: ${{ inputs.jdk_distribution }}
        java-version: ${{ inputs.jdk_version }}

    - name: Setup Android SDK
      uses: android-actions/setup-android@9fc6c4e9069bf8d3d10b2204b1fb8f6ef7065407 # v3.2.2
      with:
        packages: ${{ inputs.android_packages }}
        cmdline-tools-version: 13114758

    - name: Enable Hardware Acceleration
      shell: bash
      run: |
        echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666", OPTIONS+="static_node=kvm"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules
        sudo udevadm control --reload-rules
        sudo udevadm trigger --name-match=kvm

    - name: Fix emulator directory permissions
      shell: bash
      run: sudo chown -R $(whoami):$(id -ng) /usr/local/lib/android/sdk/emulator/
