"use strict";const __rslib_import_meta_url__="u"<typeof document?new(require("url".replace("",""))).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href;exports.ids=["804"],exports.modules={"../../../node_modules/.pnpm/@smithy+credential-provider-imds@3.2.1/node_modules/@smithy/credential-provider-imds/dist-es/index.js"(e,t,r){r.d(t,{httpRequest:()=>p,ENV_CMDS_FULL_URI:()=>g,getInstanceMetadataEndpoint:()=>k,ENV_CMDS_RELATIVE_URI:()=>w,fromContainerMetadata:()=>I,fromInstanceMetadata:()=>$});var a,n,o,i,s=r("../../../node_modules/.pnpm/@smithy+property-provider@3.1.4/node_modules/@smithy/property-provider/dist-es/index.js"),c=r("url"),d=r("buffer"),l=r("http");function p(e){return new Promise((t,r)=>{let a=(0,l.request)({method:"GET",...e,hostname:e.hostname?.replace(/^\[(.+)\]$/,"$1")});a.on("error",e=>{r(Object.assign(new s.mZ("Unable to connect to instance metadata service"),e)),a.destroy()}),a.on("timeout",()=>{r(new s.mZ("TimeoutError from instance metadata service")),a.destroy()}),a.on("response",e=>{let{statusCode:n=400}=e;(n<200||300<=n)&&(r(Object.assign(new s.mZ("Error response received from instance metadata service"),{statusCode:n})),a.destroy());let o=[];e.on("data",e=>{o.push(e)}),e.on("end",()=>{t(d.Buffer.concat(o)),a.destroy()})}),a.end()})}let m=e=>!!e&&"object"==typeof e&&"string"==typeof e.AccessKeyId&&"string"==typeof e.SecretAccessKey&&"string"==typeof e.Token&&"string"==typeof e.Expiration,u=e=>({accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:new Date(e.Expiration),...e.AccountId&&{accountId:e.AccountId}}),h=1e3,f=0,v=({maxRetries:e=f,timeout:t=h})=>({maxRetries:e,timeout:t}),_=(e,t)=>{let r=e();for(let a=0;a<t;a++)r=r.catch(e);return r},g="AWS_CONTAINER_CREDENTIALS_FULL_URI",w="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",y="AWS_CONTAINER_AUTHORIZATION_TOKEN",I=(e={})=>{let{timeout:t,maxRetries:r}=v(e);return()=>_(async()=>{let r=await b({logger:e.logger}),a=JSON.parse(await E(t,r));if(!m(a))throw new s.C1("Invalid response received from instance metadata service.",{logger:e.logger});return u(a)},r)},E=async(e,t)=>(process.env[y]&&(t.headers={...t.headers,Authorization:process.env[y]}),(await p({...t,timeout:e})).toString()),A={localhost:!0,"127.0.0.1":!0},S={"http:":!0,"https:":!0},b=async({logger:e})=>{if(process.env[w])return{hostname:"169.254.170.2",path:process.env[w]};if(process.env[g]){let t=(0,c.parse)(process.env[g]);if(!t.hostname||!(t.hostname in A))throw new s.C1(`${t.hostname} is not a valid container metadata service hostname`,{tryNextLink:!1,logger:e});if(!t.protocol||!(t.protocol in S))throw new s.C1(`${t.protocol} is not a valid container metadata service protocol`,{tryNextLink:!1,logger:e});return{...t,port:t.port?parseInt(t.port,10):void 0}}throw new s.C1(`The container metadata credential provider cannot be used unless the ${w} or ${g} environment variable is set`,{tryNextLink:!1,logger:e})};var C=r("../../../node_modules/.pnpm/@smithy+node-config-provider@3.1.5/node_modules/@smithy/node-config-provider/dist-es/index.js");class T extends s.C1{constructor(e,t=!0){super(e,t),this.tryNextLink=t,this.name="InstanceMetadataV1FallbackError",Object.setPrototypeOf(this,T.prototype)}}var x=r("../../../node_modules/.pnpm/@smithy+url-parser@3.0.4/node_modules/@smithy/url-parser/dist-es/index.js");(a=o||(o={})).IPv4="http://169.254.169.254",a.IPv6="http://[fd00:ec2::254]";let D={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT,configFileSelector:e=>e.ec2_metadata_service_endpoint,default:void 0};(n=i||(i={})).IPv4="IPv4",n.IPv6="IPv6";let N={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE,configFileSelector:e=>e.ec2_metadata_service_endpoint_mode,default:i.IPv4},k=async()=>(0,x.D)(await M()||await R()),M=async()=>(0,C.Z)(D)(),R=async()=>{let e=await (0,C.Z)(N)();switch(e){case i.IPv4:return o.IPv4;case i.IPv6:return o.IPv6;default:throw Error(`Unsupported endpoint mode: ${e}. Select from ${Object.values(i)}`)}},O=(e,t)=>{let r=300+Math.floor(300*Math.random()),a=new Date(Date.now()+1e3*r);t.warn(`Attempting credential expiration extension due to a credential service availability issue. A refresh of these credentials will be attempted after ${new Date(a)}.
For more information, please visit: https://docs.aws.amazon.com/sdkref/latest/guide/feature-static-credentials.html`);let n=e.originalExpiration??e.expiration;return{...e,...n?{originalExpiration:n}:{},expiration:a}},P="/latest/meta-data/iam/security-credentials/",L="AWS_EC2_METADATA_V1_DISABLED",V="ec2_metadata_v1_disabled",U="x-aws-ec2-metadata-token",$=(e={})=>((e,t={})=>{let r,a=t?.logger||console;return async()=>{let t;try{(t=await e()).expiration&&t.expiration.getTime()<Date.now()&&(t=O(t,a))}catch(e){if(r)a.warn("Credential renew failed: ",e),t=O(r,a);else throw e}return r=t,t}})(j(e),{logger:e.logger}),j=(e={})=>{let t=!1,{logger:r,profile:a}=e,{timeout:n,maxRetries:o}=v(e),i=async(r,n)=>{if(t||n.headers?.[U]==null){let t=!1,r=!1,n=await (0,C.Z)({environmentVariableSelector:t=>{let a=t[L];if(r=!!a&&"false"!==a,void 0===a)throw new s.C1(`${L} not set in env, checking config file next.`,{logger:e.logger});return r},configFileSelector:e=>{let r=e[V];return t=!!r&&"false"!==r},default:!1},{profile:a})();if(e.ec2MetadataV1Disabled||n){let a=[];throw e.ec2MetadataV1Disabled&&a.push("credential provider initialization (runtime option ec2MetadataV1Disabled)"),t&&a.push(`config file profile (${V})`),r&&a.push(`process environment variable (${L})`),new T(`AWS EC2 Metadata v1 fallback has been blocked by AWS SDK configuration in the following: [${a.join(", ")}].`)}}let o=(await _(async()=>{let e;try{e=await W(n)}catch(e){throw 401===e.statusCode&&(t=!1),e}return e},r)).trim();return _(async()=>{let r;try{r=await F(o,n,e)}catch(e){throw 401===e.statusCode&&(t=!1),e}return r},r)};return async()=>{let e=await k();if(t)return r?.debug("AWS SDK Instance Metadata","using v1 fallback (no token fetch)"),i(o,{...e,timeout:n});{let a;try{a=(await K({...e,timeout:n})).toString()}catch(a){if(a?.statusCode===400)throw Object.assign(a,{message:"EC2 Metadata token request returned error"});return("TimeoutError"===a.message||[403,404,405].includes(a.statusCode))&&(t=!0),r?.debug("AWS SDK Instance Metadata","using v1 fallback (initial)"),i(o,{...e,timeout:n})}return i(o,{...e,headers:{[U]:a},timeout:n})}}},K=async e=>p({...e,path:"/latest/api/token",method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}),W=async e=>(await p({...e,path:P})).toString(),F=async(e,t,r)=>{let a=JSON.parse((await p({...t,path:P+e})).toString());if(!m(a))throw new s.C1("Invalid response received from instance metadata service.",{logger:r.logger});return u(a)}}};