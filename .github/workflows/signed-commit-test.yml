name: "Signed commit test"

on:
  pull_request:

jobs:
  signed-commit-test:
    name: Signed commit test
    runs-on: ubuntu-24.04
    env:
      NODE_OPTIONS: "--max-old-space-size=7168"
      RELEASE_BRANCH: "restricted-temp-test-branch-angusbayley"
    steps:
      - name: generate token
        id: generate-token
        uses: tibdex/github-app-token@v1
        with:
          app_id: ${{ secrets.GH_BOT_APP_ID }}
          private_key: ${{ secrets.GH_BOT_PRIVATE_KEY }}
      - uses: actions/checkout@v4
        with:
          ref: develop
          token: ${{ steps.generate-token.outputs.token }}
      - name: Setup git user
        uses: LedgerHQ/ledger-live/tools/actions/composites/setup-git-user@develop
      - name: Create dummy file 3
        run: |
          echo "This is a third dummy file" > dummy3.txt
          git add .
      - name: commit the new way, but using GH app token, not GITHUB_TOKEN
        uses: planetscale/ghcommit-action@v0.1.6
        with:
          commit_message: "chore(prerelease) update cryptoassets"
          repo: ${{ github.repository }}
          branch: ${{ env.RELEASE_BRANCH }}
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}